<!DOCTYPE html>
<html dir="ltr" lang="en-US">

<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">


    <!-- ===============================================-->
    <!--    Document Title-->
    <!-- ===============================================-->
    <title>Make sale - own store</title>
    {% load static %}


    <!-- ===============================================-->
    <!--    Favicons-->
    <!-- ===============================================-->
    <link href="{% static 'img/favicons/apple-touch-icon.png' %}" rel="apple-touch-icon" sizes="180x180">
    <link href="{% static 'img/favicons/favicon-32x32.png' %}" rel="icon" sizes="32x32" type="image/png">
    <link href="{% static 'img/favicons/favicon-16x16.png' %}" rel="icon" sizes="16x16" type="image/png">
    <link href="{% static 'img/favicons/favicon.ico' %}" rel="shortcut icon" type="image/x-icon">
    <link href="{% static 'img/favicons/manifest.json' %}" rel="manifest">
    <meta content="{% static 'img/favicons/mstile-150x150.png' %}" name="msapplication-TileImage">
    <meta content="#ffffff" name="theme-color">
    <script src="{% static 'vendors/imagesloaded/imagesloaded.pkgd.min.js' %}"></script>
    <script src="{% static 'vendors/simplebar/simplebar.min.js' %}"></script>
    <script src="{% static 'js/config.js' %}"></script>

    <!-- ===============================================-->
    <!--    Stylesheets-->
    <!-- ===============================================-->
    <link href="{% static 'vendors/flatpickr/flatpickr.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendors/choices/choices.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendors/prism/prism-okaidia.css' %}" rel="stylesheet">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&amp;display=swap"
          rel="stylesheet">
    <link href="{% static 'vendors/simplebar/simplebar.min.css' %}" rel="stylesheet">
    <link href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" rel="stylesheet">
    <link href="{% static 'css/theme-rtl.min.css' %}" id="style-rtl" rel="stylesheet" type="text/css">
    <link href="{% static 'css/theme.min.css' %}" id="style-default" rel="stylesheet" type="text/css">
    <link href="{% static 'css/user-rtl.min.css' %}" id="user-style-rtl" rel="stylesheet" type="text/css">
    <link href="{% static 'css/user.min.css' %}" id="user-style-default" rel="stylesheet" type="text/css">

    <script>
      var isRTL = JSON.parse(localStorage.getItem('isRTL'));
      if (isRTL) {
        var linkDefault = document.getElementById('style-default');
        var userLinkDefault = document.getElementById('user-style-default');
        linkDefault.setAttribute('disabled', true);
        userLinkDefault.setAttribute('disabled', true);
        document.querySelector('html').setAttribute('dir', 'rtl');
      } else {
        var linkRTL = document.getElementById('style-rtl');
        var userLinkRTL = document.getElementById('user-style-rtl');
        linkRTL.setAttribute('disabled', true);
        userLinkRTL.setAttribute('disabled', true);
      }



































    </script>
</head>


<body>

<!-- ===============================================-->
<!--    Main Content-->
<!-- ===============================================-->
<main class="main" id="top">
    <div class="container-fluid px-0">
        {% include 'nav_bar_store.html' %}

        <div class="content">
            <form id="saleForm" action="{% url 'own_store_make_sale' %}" method="post">
                {% csrf_token %}

                <input name="cartData">
                <input name="customerData">
                <input name="billingDetailsData">
            </form>
            <div class="col-12 col-xxl-6">
                <div class="card shadow-none border border-300 my-4" data-component-card="data-component-card">
                    <div class="card-header p-4 border-bottom border-300 bg-soft">
                        <div class="row g-3 justify-content-between align-items-center">
                            <div class="col-12 col-md">
                                <h4 class="text-900 mb-0" data-anchor="data-anchor">Make a sale</h4>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="p-4 code-to-copy">
                            <div class="card theme-wizard mb-5" data-theme-wizard="data-theme-wizard">
                                <div class="card-header bg-100 pt-3 pb-2 border-bottom-0">
                                    <ul class="nav justify-content-between nav-wizard">
                                        <li class="nav-item"><a class="nav-link active fw-semi-bold"
                                                                href="#bootstrap-wizard-validation-tab1"
                                                                data-bs-toggle="tab" data-wizard-step="1">
                                            <div class="text-center d-inline-block"><span
                                                    class="nav-item-circle-parent"><span class="nav-item-circle"><span
                                                    class="fas fa-shopping-cart"></span></span></span><span
                                                    class="d-none d-md-block mt-1 fs--1">Products</span></div>
                                        </a></li>

                                        <li class="nav-item"><a class="nav-link fw-semi-bold"
                                                                href="#bootstrap-wizard-validation-tab2"
                                                                data-bs-toggle="tab" data-wizard-step="2">
                                            <div class="text-center d-inline-block"><span
                                                    class="nav-item-circle-parent"><span class="nav-item-circle"><span
                                                    class="fas fa-user"></span></span></span><span
                                                    class="d-none d-md-block mt-1 fs--1">Customer</span></div>
                                        </a></li>
                                        <li class="nav-item"><a class="nav-link fw-semi-bold"
                                                                href="#bootstrap-wizard-validation-tab3"
                                                                data-bs-toggle="tab" data-wizard-step="3">
                                            <div class="text-center d-inline-block"><span
                                                    class="nav-item-circle-parent"><span class="nav-item-circle"><span
                                                    class="fas fa-file-invoice-dollar"></span></span></span><span
                                                    class="d-none d-md-block mt-1 fs--1">Billing details</span></div>
                                        </a></li>

                                        <li class="nav-item"><a class="nav-link fw-semi-bold"
                                                                href="#bootstrap-wizard-validation-tab4"
                                                                data-bs-toggle="tab" data-wizard-step="4">
                                            <div class="text-center d-inline-block"><span
                                                    class="nav-item-circle-parent"><span class="nav-item-circle"><span
                                                    class="fas fa-eye"></span></span></span><span
                                                    class="d-none d-md-block mt-1 fs--1">Review</span></div>
                                        </a></li>
                                    </ul>
                                </div>

                                <div class="card-body pt-4 pb-0">
                                    <div class="tab-content">
                                        <!--                            tab 1-->
                                        <div class="tab-pane active" role="tabpanel"
                                             aria-labelledby="bootstrap-wizard-validation-tab1"
                                             id="bootstrap-wizard-validation-tab1">
                                            <form class="needs-validation" id="wizardValidationForm1"
                                                  novalidate="novalidate" data-wizard-form="1"
                                                  onchange="getProductsData()">
                                                <div id="products_container">
                                                    <!--                                                    add product here-->
                                                </div>
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="btn-group me-1 float-end">
                                                            <button class="btn dropdown-toggle mb-1 btn-primary"
                                                                    type="button" data-bs-toggle="dropdown"
                                                                    aria-haspopup="true" aria-expanded="false">Add
                                                                Product
                                                            </button>
                                                            <div class="dropdown-menu">
                                                                <a type="button" onclick="addLensContainer()"
                                                                   class="dropdown-item">Add a Lens</a>
                                                                <!--                                                                <a type="button" onclick="addStockContactLensContainer()" class="dropdown-item">Add Stock Contact Lens</a>-->
                                                                <a type="button" onclick="addRxContactLensContainer()"
                                                                   class="dropdown-item">Add Contact Lens</a>
                                                                <a type="button" onclick="addOtherProductsContainer()"
                                                                   class="dropdown-item">Add Other Products</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="tab-pane" role="tabpanel"
                                             aria-labelledby="bootstrap-wizard-validation-tab2"
                                             id="bootstrap-wizard-validation-tab2">
                                            <form class="needs-validation" id="wizardValidationForm2"
                                                  novalidate="novalidate" data-wizard-form="2">
                                                <div class="card-header bg-100 mb-4">
                                                    <h5 class="mb-3">Old customer? Choose from Below</h5>
                                                    <select onchange="updateCustomerFields(this)"
                                                            class="form-select" data-choices="data-choices"
                                                            data-options='{"removeItemButton":true,"placeholder":true}'
                                                            name="customers">
                                                        <option value="">Select Customer</option>
                                                        {% for customer in customers_list %}
                                                        <option value="{{customer.phone}}">
                                                            {{customer.phone}}
                                                        </option>
                                                        {% endfor %}
                                                    </select>
                                                    <h5 class="mb-3">New customer? Continue adding them</h5>
                                                    <div id="customer_info" class="row g-3 mb-3">
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">Customer Name</h5>
                                                            <input class="form-control"
                                                                   name="customer_name"
                                                                   placeholder="Name"
                                                                   required="required"
                                                                   onchange="genCustomerObject()"
                                                                   type="text" value=""/>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">Customer Email</h5>
                                                            <input class="form-control"
                                                                   name="customer_email"
                                                                   placeholder="Email"
                                                                   required="required"
                                                                   onchange="genCustomerObject()"
                                                                   type="email" value=""/>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">Customer Phone</h5>
                                                            <input class="form-control"
                                                                   name="customer_phone"
                                                                   placeholder="Phone"
                                                                   required="required"
                                                                   onchange="genCustomerObject()"
                                                                   min="1111111111" max="9999999999"
                                                                   type="number" value=""/>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">Customer Age</h5>
                                                            <input class="form-control"
                                                                   name="customer_age"
                                                                   placeholder="Age"
                                                                   required="required"
                                                                   onchange="genCustomerObject()"
                                                                   type="number" min="1" max="150" value=""/>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">Gender</h5>
                                                            <select
                                                                    onchange="genCustomerObject()"
                                                                    name="customer_gender" class="form-select"
                                                                    aria-label="Default select example"
                                                                    required="required">
                                                                <option value="" selected>Please select Gender</option>
                                                                <option value="M">Male</option>
                                                                <option value="F">Female</option>
                                                                <option value="Others">Others</option>
                                                            </select>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">City</h5>
                                                            <input class="form-control"
                                                                   name="customer_city"
                                                                   placeholder="City"
                                                                   required="required"
                                                                   onchange="genCustomerObject()"

                                                                   type="text" value=""/>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-12">
                                                            <h5 class="mb-3">Language</h5>
                                                            <select

                                                                    onchange="genCustomerObject()"

                                                                    name="customer_language" class="form-select"
                                                                    aria-label="Default select example"
                                                                    required="required">
                                                                <option value="" selected="selected">Please select
                                                                    Language
                                                                </option>
                                                                <option value="English">English</option>
                                                                <option value="Kannada">Kannada</option>
                                                                <option value="Hindi">Hindi</option>
                                                                <option value="Tamil">Tamil</option>
                                                                <option value="Telugu">Telugu</option>
                                                                <option value="Malayalam">Malayalam</option>
                                                                <option value="Marathi">Marathi</option>
                                                                <option value="Gujarati">Gujarati</option>
                                                            </select>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-12">
                                                            <h5 class="mb-3">Customer Address</h5>
                                                            <textarea
                                                                    onchange="genCustomerObject()"

                                                                    name="customer_address" class="form-control"
                                                                    rows="3" required="required"></textarea>
                                                        </div>


                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="tab-pane" role="tabpanel"
                                             aria-labelledby="bootstrap-wizard-validation-tab3"
                                             id="bootstrap-wizard-validation-tab3">
                                            <form class="mb-2 needs-validation" id="wizardValidationForm3"
                                                  novalidate="novalidate" data-wizard-form="3">
                                                <div class="row g-3 mb-3">
                                                    <div class="mb2 col-6">
                                                        <h5 class="mb-3">Total Item:</h5>
                                                    </div>
                                                    <div class="mb2 col-6">
                                                        <h5 class="mb-3">Billing AMount:</h5>
                                                    </div>
                                                </div>

                                                <div id="billing_info" class="row g-3 mb-3">

                                                    <div class="mb2 col-6">
                                                        <h5 class="mb-3">Order Placed By</h5>
                                                        <select
                                                                onchange="genBillingInfoObject()"
                                                                name="orderByEmployee" class="form-select"
                                                                aria-label="Default select example"
                                                                required="required">
                                                            <option value="" selected>Please select employee</option>
                                                            {% for employee in employee_list %}
                                                            <option value="{{employee.employee_id}}">{{employee.name}}
                                                            </option>
                                                            {% endfor %}
                                                        </select>
                                                        <div class="invalid-feedback">This field is required.</div>
                                                    </div>
                                                    <div class="mb2 col-6">
                                                        <h5 class="mb-3">Choose Lab</h5>
                                                        <select
                                                                onchange="genBillingInfoObject()"
                                                                name="assignedLab" class="form-select"
                                                                aria-label="Default select example"
                                                                required="required">
                                                            <option value="" selected>Please select lab</option>
                                                            {% for lab in lab_list %}
                                                            <option value="{{lab.lab_id}}">{{lab.lab_name}}</option>
                                                            {% endfor %}
                                                        </select>
                                                        <div class="invalid-feedback">This field is required.</div>
                                                    </div>

                                                    <div class="mb2 col-6">
                                                        <h5 class="mb-3">Estimated Delivery Date</h5>
                                                        <input
                                                                onchange="genBillingInfoObject()"
                                                                name="estDeliveryDate"
                                                                class="form-control datetimepicker flatpickr-input"
                                                                id="datePicker" type="text" placeholder="dd/mm/yyyy"
                                                                data-options="{&quot;disableMobile&quot;:true,&quot;dateFormat&quot;:&quot;d/m/Y&quot;}"
                                                                readonly="readonly">
                                                                                                                <div class="invalid-feedback">This field is required.</div>
                                                    </div>
                                                    <div class="mb2 col-6">
                                                        <h5 class="mb-3">Advance Amount Paid</h5>
                                                        <input
                                                                onchange="genBillingInfoObject()"
                                                                value="0" required
                                                                name="amount_paid"
                                                                class="form-control"
                                                                type="text" placeholder="&#8377;">
                                                                                                                <div class="invalid-feedback">This field is required.</div>
                                                    </div>


                                                </div>


                                                    <div class="mb2 col-12">
                                                       <h5 class="mb-3">Sale notes</h5>

                                                           <textarea
                                                                   required
                                                                   onchange="genBillingInfoObject()"
                                                                   name="sale_note" class="form-control" id="exampleTextarea" rows="3"></textarea>
                                                                                                                <div class="invalid-feedback">This field is required.</div>
                                                    </div>
                                            </form>
                                        </div>
                                        <div class="tab-pane" role="tabpanel"
                                             aria-labelledby="bootstrap-wizard-validation-tab4"
                                             id="bootstrap-wizard-validation-tab4">
                                            <h5 class="mb-3">Draft Invoice</h5>
                                            <!--                                            customer details start-->
                                            <div class="bg-soft p-4 mb-4 rounded-2">
                                                <div class="row g-4">
                                                    <div class="col-12 col-lg-6">
                                                        <div class="row g-4 g-lg-2">
                                                            <div class="col-12 col-sm-6 col-lg-12">
                                                                <div class="row align-items-center g-0">
                                                                    <div class="d-flex align-items-center"><img
                                                                            alt="phoenix"
                                                                            src="{% static 'img/icons/logo.png' %}"
                                                                            width="50"/>

                                                                        <p class="logo-text ms-2 d-none d-sm-block">
                                                                            Indolens</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-12 col-sm-6 col-lg-12">
                                                                <div class="row align-items-center g-0">
                                                                    <div class="col-auto col-lg-6 col-xl-5">
                                                                        <h6 class="me-3">Invoice Date :</h6>
                                                                    </div>
                                                                    <div class="col-auto col-lg-6 col-xl-7">
                                                                        <p class="fs--1 text-800 fw-semi-bold mb-0">
                                                                            19/06/2023</p>
                                                                    </div>
                                                                </div>
                                                                <div class="row align-items-center g-0">
                                                                    <div class="col-auto col-lg-6 col-xl-5">
                                                                        <h6 class="me-3">Email :</h6>
                                                                    </div>
                                                                    <div class="col-auto col-lg-6 col-xl-7">
                                                                        <p class="fs--1 text-800 fw-semi-bold mb-0">
                                                                            indolensstore@indlens.com</p>
                                                                    </div>
                                                                </div>
                                                                <div class="row align-items-center g-0">
                                                                    <div class="col-auto col-lg-6 col-xl-5">
                                                                        <h6 class="me-3">Phone :</h6>
                                                                    </div>
                                                                    <div class="col-auto col-lg-6 col-xl-7">
                                                                        <p class="fs--1 text-800 fw-semi-bold mb-0">
                                                                            1234567890</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-12 col-sm-6 col-lg-6">
                                                        <div class="row g-4 gy-lg-5">
                                                            <div class="col-12 col-lg-8">
                                                                <h6 class="mb-2 me-3">Draft invoice by :</h6>
                                                                <p class="fs--1 text-800 fw-semi-bold mb-0">
                                                                    store name<br/>Store Address Goes Here
                                                                </p>
                                                            </div>
                                                            <div class="col-12 col-lg-4">
                                                                <h6 class="mb-2"> PAN No :</h6>
                                                                <p class="fs--1 text-800 fw-semi-bold mb-0">
                                                                    XVCJ9637820</p>
                                                            </div>
                                                            <div class="col-12 col-lg-4">
                                                                <h6 class="mb-2"> GST Reg No :</h6>
                                                                <p class="fs--1 text-800 fw-semi-bold mb-0">
                                                                    IX9878123TC</p>
                                                            </div>
                                                            <div class="col-12 col-lg-4">
                                                                <h6 class="mb-2"> Order Date :</h6>
                                                                <p class="fs--1 text-800 fw-semi-bold mb-0">
                                                                    19/06/2023</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--                                            customer details end-->

                                            <button id="confirmSale">Confirm Sale</button>

                                        </div>

                                    </div>
                                </div>
                                <div class="card-footer border-top-0" data-wizard-footer="data-wizard-footer">
                                    <div class="d-flex pager wizard list-inline mb-0">
                                        <button class="d-none btn btn-link ps-0" type="button"
                                                data-wizard-prev-btn="data-wizard-prev-btn"><span
                                                class="fas fa-chevron-left me-1" data-fa-transform="shrink-3"></span>Previous
                                        </button>
                                        <div class="flex-1 text-end">
                                            <button class="btn btn-primary px-6 px-sm-6" type="submit"
                                                    data-wizard-next-btn="data-wizard-next-btn">Next<span
                                                    class="fas fa-chevron-right ms-1"
                                                    data-fa-transform="shrink-3"> </span></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% include 'footer.html' %}
        </div>
    </div>
    <script>
        var navbarTopStyle = localStorage.getItem('phoenixNavbarTopStyle');
        var navbarTop = document.querySelector('.navbar-top');
        if (navbarTopStyle === 'darker') {
          navbarTop.classList.add('navbar-darker');
        }

        var navbarVerticalStyle = localStorage.getItem('phoenixNavbarVerticalStyle');
        var navbarVertical = document.querySelector('.navbar-vertical');
        if (navbarVerticalStyle === 'darker') {
          navbarVertical.classList.add('navbar-darker');
        }

    </script>
</main>
<!-- ===============================================-->
<!--    End of Main Content-->
<!-- ===============================================-->

<!-- ===============================================-->
<!--    JavaScripts-->
<!-- ===============================================-->
<script src="{% static 'vendors/popper/popper.min.js' %}"></script>
<script src="{% static 'vendors/bootstrap/bootstrap.min.js' %}"></script>
<script src="{% static 'vendors/anchorjs/anchor.min.js' %}"></script>
<script src="{% static 'vendors/is/is.min.js' %}"></script>
<script src="{% static 'vendors/fontawesome/all.min.js' %}"></script>
<script src="{% static 'vendors/lodash/lodash.min.js' %}"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=window.scroll"></script>
<script src="{% static 'vendors/list.js/list.min.js' %}"></script>
<script src="{% static 'vendors/feather-icons/feather.min.js' %}"></script>
<script src="{% static 'vendors/dayjs/dayjs.min.js' %}"></script>
<script src="{% static 'vendors/choices/choices.min.js' %}"></script>
<script src="{% static 'vendors/prism/prism.js' %}"></script>
<script src="{% static 'js/phoenix.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
  var estDeliveryDateInputs = document.getElementsByName('estDeliveryDate');

  // Check if there are elements with the specified name
  if (estDeliveryDateInputs.length > 0) {
    var estDeliveryDateInput = estDeliveryDateInputs[0];

    // Get the current date
    var currentDate = new Date();

    // Calculate the date 3 days from today
    var defaultDate = new Date();
    defaultDate.setDate(currentDate.getDate() + 3);

    // Format the default date as dd/mm/yyyy
    var day = ('0' + defaultDate.getDate()).slice(-2);
    var month = ('0' + (defaultDate.getMonth() + 1)).slice(-2);
    var year = defaultDate.getFullYear();
    var formattedDefaultDate = day + '/' + month + '/' + year;

    // Set the default value to the input element
    estDeliveryDateInput.value = formattedDefaultDate;
  }

</script>
{{ lens_list|json_script:"lensList" }}
{{ contact_lens_list|json_script:"contactLensList" }}
{{ rx_contact_lens_list|json_script:"rxContactLensList" }}
{{ other_products_list|json_script:"otherProductsList" }}
{{ customers_list|json_script:"customersList" }}

<script>
let productCardCount = 1;
    var lens_list = JSON.parse(document.getElementById('lensList').textContent);
    var contact_lens_list = JSON.parse(document.getElementById('contactLensList').textContent);
    var rx_contact_lens_list = JSON.parse(document.getElementById('rxContactLensList').textContent);
    var other_products_list = JSON.parse(document.getElementById('otherProductsList').textContent);
    var customers_list = JSON.parse(document.getElementById('customersList').textContent);

function addLensContainer() {
    let lensProductCard = document.createElement("div");
    lensProductCard.classList.add("product_widget", "card-header", "bg-100", "mb-4");
    lensProductCard.innerHTML = `
    <div class="col text-end">
        <a onclick="removeProductCard(this)" type="button" class="text-danger">
            Remove <i class="fas fa-trash"></i>
        </a>
    </div>
    <div class="mb-3 col-12">
        <h5 class="mb-3">Select Lens</h5>
        <select onchange="updateLensProductFields(this, ${productCardCount})" class="form-select" data-choices="data-choices" data-options='{"removeItemButton":true,"placeholder":true}'
            name="product" required="required">
            <option value="">Select Lens</option>
            {% for product in lens_list %}
            <option value="{{product.product_id}}">
                {{product.product_name}}
            </option>
            {% endfor %}
        </select>
        <div class="custom-error" style="color: red;"></div>
    </div>
    <div class="row g-3 mb-3">
        <div class="mb2 col-4">
            <h5 class="mb-3">Lens Type</h5>
            <input class="form-control" name="lens_type[${productCardCount}]" placeholder="Lens Type" required="required" type="text" value=""
                readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Product Brand</h5>
            <input class="form-control" name="product_brand[${productCardCount}]" placeholder="Brand" required="required" type="text" value=""
                readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <!-- Add the rest of your product card HTML structure here -->
        <div class="mb2 col-4">
            <h5 class="mb-3">Product HSN</h5>
            <input class="form-control" name="product_hsn[${productCardCount}]" placeholder="HSN" required="required" type="text" value=""
                readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Available Quantity</h5>
            <input class="form-control" name="available_qty[${productCardCount}]" placeholder="Available Quantity" required="required"
                type="text" value="" readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Unit Price</h5>
            <input class="form-control" name="unit_price[${productCardCount}]" placeholder="Unit Price" required="required" type="text" value=""
                readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Unit Type</h5>
            <input class="form-control" name="unit_type[${productCardCount}]" placeholder="Unit Type" required="required" type="text" value=""
                readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Stock Type</h5>
            <input class="form-control" name="stock_type[${productCardCount}]" placeholder="Rx/Stock" required="required" min="1"
                type="text" value="" />
            <div class="invalid-feedback">This field should be 1 in
                minimum and should be less than available quantity.
            </div>
        </div>

        <input class="form-control"
                   name="product_category_id[${productCardCount}]"
                   placeholder="Category"
                   required="required"
                   hidden
                   type="text" value="" readonly/>
        <div class="mb2 col-4">
            <h5 class="mb-3">Purchase Quantity</h5>
            <input class="form-control" name="purchase_qty[${productCardCount}]" placeholder="Purchase quantity" required="required" min="1"
                type="text" value="" />
            <div class="invalid-feedback">This field should be 1 in
                minimum and should be less than available quantity.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Product Total</h5>
            <input class="form-control" name="product_total[${productCardCount}]" placeholder="Product Total" required="required" type="text"
                value="0" readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6" id="discount_check_div[${productCardCount}]" style="display:none">
            <input id="discount_value_field[${productCardCount}]" type="hidden" class="form-check" name="discount_percentage[${productCardCount}]" required="required"
                readonly />
            <input class="form-check-input" type="checkbox" name="discount_checked[${productCardCount}]"
                id="bootstrap-wizard-validation-wizard-checkbox[${productCardCount}]" />
            <label id="discount_value[${productCardCount}]" class="form-check-label text-900"
                for="bootstrap-wizard-validation-wizard-checkbox[${productCardCount}]"></label>
        </div>
    </div>
    <div class="dropdown-divider"></div>
    <h5 class="mb-3">Power attributes</h5>
    <div class="row mb-3 stock_power_card[${productCardCount}]" id="stock_power_card[${productCardCount}]" style="display:none">
        <div class="col-12">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Eye</th>
                        <th scope="col">Sph</th>
                        <th scope="col">Cyl</th>
                        <th scope="col">Axis</th>
                        <th scope="col">Add</th>
                        <th scope="col">PD</th>
                    </tr>
                </thead>
                <tbody class="stock_power_card_table[${productCardCount}]" id="stock_power_card_table[${productCardCount}]">

                    <tr>
                        <th scope="row">Right</th>
                        <td class="col-6 col-lg-2">
                            <select required name="rightLensSphStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="1">1</option>
                                <option value="2">2</option>
                            </select>
                                        <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <select required name="rightLensCylStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="1">1</option>
                            </select>
                                        <div class="invalid-feedback">This field is required.
                        </td>
                        <td class="col-6 col-lg-2">
                            <select required name="rightLensAxisStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="1">1</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <select required name="rightLensAddStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="1">1</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <select required name="rightLensPdStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="1">1</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                    </tr>

                     <tr>
                        <th scope="row">Left</th>
                        <td class="col-6 col-lg-2">
                            <select required name="leftLensSphStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="1">1</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <select required name="leftLensCylStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="1">1</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <select  required name="leftLensAxisStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="1">1</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <select required name="leftLensAddStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="1">1</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <select required name="leftLensPdStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="1">1</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row mb-3 rx_power_card[${productCardCount}]" id="rx_power_card[${productCardCount}]" style="display:none">
        <div class="col-12">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Eye</th>
                        <th scope="col">Sph</th>
                        <th scope="col">Cyl</th>
                        <th scope="col">Axis</th>
                        <th scope="col">Add</th>
                        <th scope="col">PD</th>
                    </tr>
                </thead>
                <tbody class="rx_power_card_table[${productCardCount}]" id="rx_power_card_table[${productCardCount}]">
                    <tr>
                        <th scope="row">Right</th>
                        <td class="col-6 col-lg-2">
                            <input required name="rightLensSphRx[${productCardCount}]" class="form-control" aria-label="Default select example" />
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <input required name="rightLensCylRx[${productCardCount}]" class="form-control" aria-label="Default select example" />
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <input required name="rightLensAxisRx[${productCardCount}]" class="form-control" aria-label="Default select example" />
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <input required name="rightLensAddRx[${productCardCount}]" class="form-control" aria-label="Default select example" />
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <input required name="rightLensPdRx[${productCardCount}]" class="form-control" aria-label="Default select example" />
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                    </tr>
                     <tr>
                        <th scope="row">Left</th>
                        <td class="col-6 col-lg-2">
                            <input required name="leftLensSphRx[${productCardCount}]" class="form-control" aria-label="Default select example" />
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <input required name="leftLensCylRx[${productCardCount}]" class="form-control" aria-label="Default select example">
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <input required name="leftLensAxisRx[${productCardCount}]" class="form-control" aria-label="Default select example" />
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <input required name="leftLensAddRx[${productCardCount}]" class="form-control" aria-label="Default select example" />
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-6 col-lg-2">
                            <input required name="leftLensPdRx[${productCardCount}]" class="form-control" aria-label="Default select example" />
                                                                    <div class="invalid-feedback">This field is required.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>`;

    document.querySelector("#products_container").appendChild(lensProductCard);

    let choicesInstance = new Choices(lensProductCard.querySelector("[name='product']"), {
        // Pass any necessary options for Choices.js
        removeItemButton: true,
        placeholder: true,
    });

    productCardCount++;

}


    function addStockContactLensContainer(){
    let contactLensProductCard = document.createElement("div");
    contactLensProductCard.classList.add("product_widget", "card-header", "bg-100", "mb-4");
    contactLensProductCard.innerHTML = `

    <div class="col text-end">
        <a onclick="removeProductCard(this)" type="button" class="text-danger">
            Remove <i class="fas fa-trash"></i>
        </a>
    </div>

    <div class="mb-3 col-12">
        <h5 class="mb-3">Select Contact Lens</h5>
        <select onchange="updateContactLensProductFields(this, ${productCardCount})" class="form-select" data-choices="data-choices"
                data-options='{"removeItemButton":true,"placeholder":true}'
                name="product" required="required">
            <option value="">Select Contact Lens</option>
            {% for product in contact_lens_list %}
            {% if product.category_id == 3 %}
            <option value="{{product.product_id}}">
                {{product.product_name}}
            </option>
            {% endif %}
            {% endfor %}
        </select>
        <div class="custom-error" style="color: red;"></div>
    </div>
    <div class="row g-3 mb-3">
        <div class="mb2 col-4">
            <h5 class="mb-3">Lens Type</h5>
            <input class="form-control"
                   name="lens_type[${productCardCount}]"
                   placeholder="Stock/Rx"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>

        <input class="form-control"
                   name="product_category_id[${productCardCount}]"
                   placeholder="Category"
                   required="required"
                   hidden

                   type="text" value="" readonly/>
        <div class="mb2 col-4">
            <h5 class="mb-3">Contact Lens Physicality</h5>
            <input class="form-control"
                   name="lens_physicality[${productCardCount}]"
                   placeholder="Physicality"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Contact Lens Disposablility</h5>
            <input class="form-control"
                   name="lens_disposablility[${productCardCount}]"
                   placeholder="Disposablility"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
<!--        <div class="mb2 col-4">-->
<!--            <h5 class="mb-3">Vision Type</h5>-->
<!--            <input class="form-control"-->
<!--                   name="vision_type[${productCardCount}]"-->
<!--                   placeholder="Vision Type"-->
<!--                   required="required"-->
<!--                   type="text" value="" readonly/>-->
<!--            <div class="invalid-feedback">This field is required.-->
<!--            </div>-->
<!--        </div>-->
        <div class="mb2 col-4">
            <h5 class="mb-3">Product Brand</h5>
            <input class="form-control"
                   name="product_brand[${productCardCount}]"
                   placeholder="Brand"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <!-- Add the rest of your product card HTML structure here -->
        <div class="mb2 col-4">
            <h5 class="mb-3">Product HSN</h5>
            <input class="form-control"
                   name="product_hsn[${productCardCount}]"
                   placeholder="HSN"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Available Quantity</h5>
            <input class="form-control"
                   name="available_qty[${productCardCount}]"
                   placeholder="Available Quantity"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Unit Price</h5>
            <input class="form-control"
                   name="unit_price[${productCardCount}]"
                   placeholder="Unit Price"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Unit Type</h5>
            <input class="form-control"
                   name="unit_type[${productCardCount}]"
                   placeholder="Unit Type"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6">
            <h5 class="mb-3">Purchase Quantity</h5>
            <input class="form-control"
                   name="purchase_qty[${productCardCount}]"
                   placeholder="Purchase quantity"
                   required="required"
                   min="1"
                   type="text" value=""/>
            <div class="invalid-feedback">This field should be 1 in
                minimum and should be less than available quantity.
            </div>
        </div>
        <div class="mb2 col-6">
            <h5 class="mb-3">Product Total</h5>
            <input class="form-control"
                   name="product_total[${productCardCount}]"
                   placeholder="Product Total"
                   required="required"
                   type="text" value="0" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6" id="discount_check_div[${productCardCount}]">
            <input id="discount_value_field[${productCardCount}]"
                   type="hidden"
                   class="form-check"
                   name="discount_percentage[${productCardCount}]"
                   required="required" readonly/>
            <input class="form-check-input" type="checkbox"
                   name="discount_checked[${productCardCount}]"
                   id="bootstrap-wizard-validation-wizard-checkbox_cl"/>
            <label id="discount_value[${productCardCount}]"
                   class="form-check-label text-900"
                   for="bootstrap-wizard-validation-wizard-checkbox"></label>
        </div>
    </div>
    <div class="dropdown-divider"></div>
    <h5 class="mb-3">Power attributes</h5>

    <div class="row mb-3 cl_rx_power_card" id="cl_rx_power_card[${productCardCount}]">
        <div class="col-12">
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">Power</th>
                    <th scope="col">BC</th>
                    <th scope="col">Dia</th>
                    <th scope="col">Cylinder</th>
                    <th scope="col">Axis</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="col-4 col-lg-2">
                        <input readonly name="cl_power[${productCardCount}]"
                               class="form-control"
                               aria-label="Default select example"/>
                    </td>
                    <td class="col-4 col-lg-2">
                        <input readonly name="cl_bc[${productCardCount}]"
                               class="form-control"
                               aria-label="Default select example">
                    </td>
                    <td class="col-4 col-lg-2">
                        <input readonly name="cl_dia[${productCardCount}]"
                               class="form-control"
                               aria-label="Default select example"/>
                    </td>
                    <td class="col-4 col-lg-2">
                        <input readonly name="cl_cylinder[${productCardCount}]"
                               class="form-control"
                               aria-label="Default select example"/>
                    </td>
                    <td class="col-4 col-lg-2">
                        <input readonly name="cl_axis[${productCardCount}]"

                               class="form-control"
                               aria-label="Default select example"/>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    `;

    document.querySelector("#products_container").appendChild(contactLensProductCard);
    let choicesInstance = new Choices(contactLensProductCard.querySelector("[name='product']"), {
        // Pass any necessary options for Choices.js
        removeItemButton: true,
        placeholder: true,
    });

    productCardCount++;

    }



    function addRxContactLensContainer(){
    let contactLensProductCard = document.createElement("div");
    contactLensProductCard.classList.add("product_widget", "card-header", "bg-100", "mb-4");
    contactLensProductCard.innerHTML = `

    <div class="col text-end">
        <a onclick="removeProductCard(this)" type="button" class="text-danger">
            Remove <i class="fas fa-trash"></i>
        </a>
    </div>

    <div class="mb-3 col-12">
        <h5 class="mb-3">Select Contact Lens</h5>
        <select onchange="updateRxContactLensProductFields(this, ${productCardCount})" class="form-select" data-choices="data-choices"
                data-options='{"removeItemButton":true,"placeholder":true}'
                name="product" required="required">
            <option value="">Select Contact Lens</option>
            {% for product in contact_lens_list %}
            {% if product.category_id == 3 %}
            <option value="{{product.product_id}}">
                {{product.product_name}}
            </option>
            {% endif %}
            {% endfor %}
        </select>
        <div class="custom-error" style="color: red;"></div>
    </div>
    <div class="row g-3 mb-3">
        <div class="mb2 col-4">
            <h5 class="mb-3">Stock Type</h5>
            <input class="form-control"
                   name="ContactLensStockType[${productCardCount}]"
                   placeholder="Stock/Rx"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>

        <input class="form-control"
                   name="product_category_id[${productCardCount}]"
                   placeholder="Category"
                   required="required"
                   hidden

                   type="text" value="" readonly/>
        <div class="mb2 col-4">
            <h5 class="mb-3">Contact Lens Physicality</h5>
            <input class="form-control"
                   name="lens_physicality[${productCardCount}]"
                   placeholder="Physicality"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Contact Lens Disposablility</h5>
            <input class="form-control"
                   name="lens_disposablility[${productCardCount}]"
                   placeholder="Disposablility"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
<!--        <div class="mb2 col-4">-->
<!--            <h5 class="mb-3">Vision Type</h5>-->
<!--            <input class="form-control"-->
<!--                   name="vision_type[${productCardCount}]"-->
<!--                   placeholder="Vision Type"-->
<!--                   required="required"-->
<!--                   type="text" value="" readonly/>-->
<!--            <div class="invalid-feedback">This field is required.-->
<!--            </div>-->
<!--        </div>-->
        <div class="mb2 col-4">
            <h5 class="mb-3">Product Brand</h5>
            <input class="form-control"
                   name="product_brand[${productCardCount}]"
                   placeholder="Brand"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <!-- Add the rest of your product card HTML structure here -->
        <div class="mb2 col-4">
            <h5 class="mb-3">Product HSN</h5>
            <input class="form-control"
                   name="product_hsn[${productCardCount}]"
                   placeholder="HSN"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Available Quantity</h5>
            <input class="form-control"
                   name="available_qty[${productCardCount}]"
                   placeholder="Available Quantity"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Unit Price</h5>
            <input class="form-control"
                   name="unit_price[${productCardCount}]"
                   placeholder="Unit Price"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Unit Type</h5>
            <input class="form-control"
                   name="unit_type[${productCardCount}]"
                   placeholder="Unit Type"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6">
            <h5 class="mb-3">Purchase Quantity</h5>
            <input class="form-control"
                   name="purchase_qty[${productCardCount}]"
                   placeholder="Purchase quantity"
                   required="required"
                   min="1"
                   type="text" value=""/>
            <div class="invalid-feedback">This field should be 1 in
                minimum and should be less than available quantity.
            </div>
        </div>
        <div class="mb2 col-6">
            <h5 class="mb-3">Product Total</h5>
            <input class="form-control"
                   name="product_total[${productCardCount}]"
                   placeholder="Product Total"
                   required="required"
                   type="text" value="0" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6" id="discount_check_div[${productCardCount}]">
            <input id="discount_value_field[${productCardCount}]"
                   type="hidden"
                   class="form-check"
                   name="discount_percentage[${productCardCount}]"
                   required="required" readonly/>
            <input class="form-check-input" type="checkbox"
                   name="discount_checked[${productCardCount}]"
                   id="bootstrap-wizard-validation-wizard-checkbox_cl"/>
            <label id="discount_value[${productCardCount}]"
                   class="form-check-label text-900"
                   for="bootstrap-wizard-validation-wizard-checkbox"></label>
        </div>
    </div>
    <div class="dropdown-divider"></div>
    <h5 class="mb-3">Power attributes</h5>

    <div class="row mb-3 cl_rx_power_card" id="cl_rx_power_card[${productCardCount}]">
        <div class="col-12">
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">Power</th>
                    <th scope="col">BC</th>
                    <th scope="col">Dia</th>
                    <th scope="col">Cylinder</th>
                    <th scope="col">Axis</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="col-4 col-lg-2">
                        <input name="cl_power[${productCardCount}]"
                               class="form-control"
                               required="required"
                               aria-label="Default select example"/>
                                           <div class="invalid-feedback">This field is required.

                    </td>
                    <td class="col-4 col-lg-2">
                        <input name="cl_bc[${productCardCount}]"
                               class="form-control"
                               required="required"
                               aria-label="Default select example">
                                           <div class="invalid-feedback">This field is required.

                    </td>
                    <td class="col-4 col-lg-2">
                        <input name="cl_dia[${productCardCount}]"
                               class="form-control"
                               required="required"
                               aria-label="Default select example"/>
                                           <div class="invalid-feedback">This field is required.

                    </td>
                    <td class="col-4 col-lg-2">
                        <input name="cl_cylinder[${productCardCount}]"
                               class="form-control"
                               required="required"
                               aria-label="Default select example"/>
                                           <div class="invalid-feedback">This field is required.

                    </td>
                    <td class="col-4 col-lg-2">
                        <input name="cl_axis[${productCardCount}]"
                        required="required"
                               class="form-control"
                               aria-label="Default select example"/>
                                           <div class="invalid-feedback">This field is required.

                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    `;

    document.querySelector("#products_container").appendChild(contactLensProductCard);
    let choicesInstance = new Choices(contactLensProductCard.querySelector("[name='product']"), {
        // Pass any necessary options for Choices.js
        removeItemButton: true,
        placeholder: true,
    });

    productCardCount++;

    }


    function addOtherProductsContainer(){
     let contactLensProductCard = document.createElement("div");
    contactLensProductCard.classList.add("product_widget", "card-header", "bg-100", "mb-4");
    contactLensProductCard.innerHTML = `
    <div class="col text-end">
        <a onclick="removeProductCard(this)" type="button" class="text-danger">
            Remove <i class="fas fa-trash"></i>
        </a>
    </div>

    <div class="mb-3 col-12">
        <h5 class="mb-3">Select Product</h5>
        <select onchange="updateOtherProductFields(this, ${productCardCount})" class="form-select" data-choices="data-choices"
                data-options='{"removeItemButton":true,"placeholder":true}'
                name="product" required="required">
            <option value="">Select Product</option>
            {% for product in other_products_list %}
            <option value="{{product.product_id}}">
                {{product.product_name}}
            </option>
            {% endfor %}
        </select>
        <div class="custom-error" style="color: red;"></div>
    </div>
    <div class="row g-3 mb-3">
        <div class="mb2 col-4">
            <h5 class="mb-3">Product Category</h5>
            <input class="form-control"
                   name="product_category[${productCardCount}]"
                   placeholder="Category"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <input class="form-control"
                   name="product_category_id[${productCardCount}]"
                   placeholder="Category"
                   hidden
                   required="required"
                   type="text" value="" readonly/>
        <div class="mb2 col-4">
            <h5 class="mb-3">Product Brand</h5>
            <input class="form-control"
                   name="product_brand[${productCardCount}]"
                   placeholder="Brand"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <!-- Add the rest of your product card HTML structure here -->
        <div class="mb2 col-4">
            <h5 class="mb-3">Product HSN</h5>
            <input class="form-control"
                   name="product_hsn[${productCardCount}]"
                   placeholder="HSN"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Available Quantity</h5>
            <input class="form-control"
                   name="available_qty[${productCardCount}]"
                   placeholder="Available Quantity"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Unit Price</h5>
            <input class="form-control"
                   name="unit_price[${productCardCount}]"
                   placeholder="Unit Price"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h5 class="mb-3">Unit Type</h5>
            <input class="form-control"
                   name="unit_type[${productCardCount}]"
                   placeholder="Unit Type"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6">
            <h5 class="mb-3">Purchase Quantity</h5>
            <input class="form-control"
                   name="purchase_qty[${productCardCount}]"
                   placeholder="Purchase quantity"
                   required="required"
                   min="1"
                   type="text" value=""/>
            <div class="invalid-feedback">This field should be 1 in
                minimum and should be less than available quantity.
            </div>
        </div>
        <div class="mb2 col-6">
            <h5 class="mb-3">Product Total</h5>
            <input class="form-control"
                   name="product_total[${productCardCount}]"
                   placeholder="Product Total"
                   required="required"
                   type="text" value="0" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6" id="discount_check_div[${productCardCount}]">
            <input id="discount_value_field[${productCardCount}]"
                   type="hidden"
                   class="form-check"
                   name="discount_percentage[${productCardCount}]"
                   required="required" readonly/>
            <input class="form-check-input" type="checkbox"
                   name="discount_checked[${productCardCount}]"
                   id="bootstrap-wizard-validation-wizard-checkbox_cl"/>
            <label id="discount_value[${productCardCount}]"
                   class="form-check-label text-900"
                   for="discount_value_field[${productCardCount}]"></label>
        </div>
    </div>`;

     document.querySelector("#products_container").appendChild(contactLensProductCard);
    let choicesInstance = new Choices(contactLensProductCard.querySelector("[name='product']"), {
        // Pass any necessary options for Choices.js
        removeItemButton: true,
        placeholder: true,
    });

    productCardCount++;

    }

    function removeProductCard(removeButton) {
    // Find the parent product card and remove it
    let productCard = removeButton.closest(".product_widget");
    if (productCard) {
        productCard.remove();
    }
    }

</script>

<script>

    function updateCustomerFields(selectCustomerField) {
        var customers_list = JSON.parse(document.getElementById('customersList').textContent);
        let selectCustomer = customers_list.find(customer => customer.phone == selectCustomerField.value);

        var customerNameInput = document.getElementsByName("customer_name")[0];
        var customerEmailInput = document.getElementsByName("customer_email")[0];
        var customerPhoneInput = document.getElementsByName("customer_phone")[0];
        var customerAgeInput = document.getElementsByName("customer_age")[0];
        var customerGenderSelect = document.getElementsByName("customer_gender")[0];
        var customerCityInput = document.getElementsByName("customer_city")[0];
        var customerLanguageSelect = document.getElementsByName("customer_language")[0];
        var customerAddressTextarea = document.getElementsByName("customer_address")[0];
        //customerDataField
        var customerDataTextarea = document.getElementsByName("customerData")[0];

        customerNameInput.value = selectCustomer.name;
        customerEmailInput.value = selectCustomer.email;
        customerPhoneInput.value = selectCustomer.phone;
        customerAgeInput.value = selectCustomer.age;
        customerGenderSelect.value = selectCustomer.gender;
        customerCityInput.value = selectCustomer.city;
        customerLanguageSelect.value = selectCustomer.language;
        customerAddressTextarea.value = selectCustomer.address;
        customerDataTextarea.value = selectCustomer.address;

        var customerdata = {
            name: selectCustomer.name,
            email: selectCustomer.email,
            phone: selectCustomer.phone,
            age: selectCustomer.age,
            gender: selectCustomer.gender,
            city: selectCustomer.city,
            language: selectCustomer.language,
            address: selectCustomer.address
        };

        // Convert customerdata to JSON string and assign it to customerDataTextarea
        customerDataTextarea.value = JSON.stringify(customerdata, null, 2);
    }

    function genCustomerObject() {
        var customerNameInput = document.getElementsByName("customer_name")[0];
        var customerEmailInput = document.getElementsByName("customer_email")[0];
        var customerPhoneInput = document.getElementsByName("customer_phone")[0];
        var customerAgeInput = document.getElementsByName("customer_age")[0];
        var customerGenderSelect = document.getElementsByName("customer_gender")[0];
        var customerCityInput = document.getElementsByName("customer_city")[0];
        var customerLanguageSelect = document.getElementsByName("customer_language")[0];
        var customerAddressTextarea = document.getElementsByName("customer_address")[0];
        //customerDataField
        var customerDataTextarea = document.getElementsByName("customerData")[0];

        var customerData = {
            name: customerNameInput.value,
            email: customerEmailInput.value,
            phone: customerPhoneInput.value,
            age: customerAgeInput.value,
            gender: customerGenderSelect.value,
            city: customerCityInput.value,
            language: customerLanguageSelect.value,
            address: customerAddressTextarea.value
        };
        customerDataTextarea.value = JSON.stringify(customerData, null, 2);
    }

    function genBillingInfoObject() {
        var estDeliveryDateInput = document.getElementsByName("estDeliveryDate")[0];
        var assignedLabInput = document.getElementsByName("assignedLab")[0];
        var orderByEmployeeInput = document.getElementsByName("orderByEmployee")[0];
        var billingDetailsDataTextarea = document.getElementsByName("billingDetailsData")[0];
        var amountPaidInput = document.getElementsByName("amount_paid")[0];
        var saleNoteInput = document.getElementsByName("sale_note")[0];
        var billingInfoData = {
            estDeliveryDate: estDeliveryDateInput.value,
            assignedLab: assignedLabInput.value,
            orderByEmployee: orderByEmployeeInput.value,
            amount_paid: amountPaidInput.value,
            orderId: "ORDER"+generateRandomId(),
            "saleNote":saleNoteInput.value
        };
        billingDetailsDataTextarea.value = JSON.stringify(billingInfoData, null, 2);
    }

function generateRandomId() {
  const epochTime = new Date().getTime(); // Get current epoch time
  const randomNum = Math.floor(Math.random() * 10000); // Generate a random number
  const randomId = `${epochTime}${randomNum}`;
  return randomId;
}
    document.getElementById('confirmSale').addEventListener('click', function () {
        // Assuming you have input fields within the form, adjust as needed
        var form = document.getElementById('saleForm');
        form.submit();
    });

</script>


<script>

    function updateLensProductFields(selectElement, cardIndex){
        let selectedProduct = lens_list.find(product => product.product_id == selectElement.value);
        let productUnitTypeField = document.querySelector(`[name='unit_type[${cardIndex}]']`);
        let productCategoryIdField = document.querySelector(`[name='product_category_id[${cardIndex}]']`);
        let stockTypeField = document.querySelector(`[name='stock_type[${cardIndex}]']`);
        let productLensTypeField = document.querySelector(`[name='lens_type[${cardIndex}]']`);
        let productBrandField = document.querySelector(`[name='product_brand[${cardIndex}]']`);
        let productHsnField = document.querySelector(`[name='product_hsn[${cardIndex}]']`);
        let productAvailableQtyField = document.querySelector(`[name='available_qty[${cardIndex}]']`);
        let productUnitPriceField = document.querySelector(`[name='unit_price[${cardIndex}]']`);
        let productPurchaseQtyField = document.querySelector(`[name='purchase_qty[${cardIndex}]']`);
        let productProductTotalField = document.querySelector(`[name='product_total[${cardIndex}]']`);
        let productDiscountCheckedField = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
        let discountCheckDiv = document.getElementById('discount_check_div[' + cardIndex + ']');
        let discountValueText = document.getElementById('discount_value[' + cardIndex + ']');
        let discountValueField = document.getElementById('discount_value_field[' + cardIndex + ']');
        let discountCheckbox = document.querySelector(`[name='discount_checked[${cardIndex}]']`);

        let stockPowerCard =  document.getElementById('stock_power_card[' + cardIndex + ']');
        let rxPowerCard =  document.getElementById('rx_power_card[' + cardIndex + ']');

        productBrandField.value = selectedProduct?.brand_name ?? '';
        productLensTypeField.value = selectedProduct?.power_attribute.vision_type ?? '';
        productHsnField.value = selectedProduct?.hsn ?? '';
        productAvailableQtyField.value = selectedProduct?.product_quantity ?? '';
        productUnitPriceField.value = selectedProduct?.sale_price ?? '';
        productUnitPriceField.value = selectedProduct?.sale_price ?? '';
        productUnitTypeField.value = selectedProduct?.unit_name ?? '';
        stockTypeField.value = selectedProduct?.power_attribute.stock_type ?? '';
        productCategoryIdField.value = selectedProduct?.category_id ?? '';

        if (selectedProduct.discount > 0) {
            discountCheckDiv.style.display = 'block';
            discountValueText.innerHTML = '<h5>Discount available !</h5> Apply discount : ' + selectedProduct.discount + '%';
            discountValueField.value = selectedProduct.discount;
        } else {
            discountCheckDiv.style.display = 'none';
        }
        if (selectedProduct.power_attribute.stock_type=='stock'){

            $('#stock_power_card_table input, #stock_power_card_table select').prop('required', true);
            $('#rx_power_card_table input, #rx_power_card_table select').prop('required', false);


        stockPowerCard.style.display = 'block';
        rxPowerCard.style.display = 'none';
        }else{
               $('#stock_power_card_table input, #stock_power_card_table select').prop('required', false);
            $('#rx_power_card_table input, #rx_power_card_table select').prop('required', true);

        rxPowerCard.style.display = 'block';
        stockPowerCard.style.display = 'none';
        }

        productPurchaseQtyField.addEventListener('input', function () {
            let purchaseQty = parseFloat(productPurchaseQtyField.value) || 0;
            let productTotal;
            if (discountCheckbox.checked) {
                // Apply discount if the checkbox is checked
                let discountPercentage = parseFloat(discountValueField.value) || 0;
                let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
                productTotal = purchaseQty * discountedPrice;
            } else {
                // No discount, use the original sale price
                productTotal = purchaseQty * parseFloat(selectedProduct.sale_price) || 0;
            }
            productProductTotalField.value = productTotal.toFixed(2);
        });

        discountCheckbox.addEventListener('change', function () {
            let isChecked = discountCheckbox.checked;
            if (isChecked) {
                let discountPercentage = parseFloat(discountValueField.value) || 0;
                let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
                productProductTotalField.value = (discountedPrice * productPurchaseQtyField.value).toFixed(2);
            } else {
                productProductTotalField.value = (selectedProduct.sale_price * productPurchaseQtyField.value).toFixed(2);
                productProductTotalField.innerHTML = '';
            }
        });
    }

    function updateContactLensProductFields(selectElement, cardIndex){
      let selectedProduct = contact_lens_list.find(product => product.product_id == selectElement.value);
      let lensTypeField = document.querySelector(`[name='lens_type[${cardIndex}]']`);
      let lensPhysicalityField = document.querySelector(`[name='lens_physicality[${cardIndex}]']`);
      let lensDisposablilityField = document.querySelector(`[name='lens_disposablility[${cardIndex}]']`);
      let lensVisionTypeField = document.querySelector(`[name='vision_type[${cardIndex}]']`);
      let productBrandField = document.querySelector(`[name='product_brand[${cardIndex}]']`);
      let productHsnField = document.querySelector(`[name='product_hsn[${cardIndex}]']`);
      let productAvailableQtyField = document.querySelector(`[name='available_qty[${cardIndex}]']`);
      let productUnitPriceField = document.querySelector(`[name='unit_price[${cardIndex}]']`);
      let productPurchaseQtyField = document.querySelector(`[name='purchase_qty[${cardIndex}]']`);        let productProductTotalField = document.querySelector(`[name='product_total[${cardIndex}]']`);
      let productDiscountCheckedField = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
      let discountCheckDiv = document.getElementById('discount_check_div[' + cardIndex + ']');
      let discountValueText = document.getElementById('discount_value[' + cardIndex + ']');
      let discountValueField = document.getElementById('discount_value_field[' + cardIndex + ']');
      let discountCheckbox = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
      let productUnitTypeField = document.querySelector(`[name='unit_type[${cardIndex}]']`);
      let clPowerField = document.querySelector(`[name='cl_power[${cardIndex}]']`);
      let clBcField = document.querySelector(`[name='cl_bc[${cardIndex}]']`);
      let clDiaField = document.querySelector(`[name='cl_dia[${cardIndex}]']`);
      let clCylField = document.querySelector(`[name='cl_cylinder[${cardIndex}]']`);
      let clAxisField = document.querySelector(`[name='cl_axis[${cardIndex}]']`);
      let productCategoryIdField = document.querySelector(`[name='product_category_id[${cardIndex}]']`);

      lensTypeField.value = selectedProduct?.power_attribute.stock_type ?? '';
      lensPhysicalityField.value = selectedProduct?.power_attribute.contact_lens_type ?? '';
      lensDisposablilityField.value = selectedProduct?.power_attribute.contact_lens_disposability ?? '';
<!--      lensVisionTypeField.value = selectedProduct?.vision_type ?? '';-->
      productHsnField.value = selectedProduct?.hsn ?? '';
      productAvailableQtyField.value = selectedProduct?.store_product_quantity ?? '';
      productBrandField.value = selectedProduct?.brand_name ?? '';
      productUnitPriceField.value = selectedProduct?.sale_price ?? '';
      productUnitTypeField.value = selectedProduct?.unit_name ?? '';
      productCategoryIdField.value = selectedProduct?.category_id ?? '';


      clPowerField.value = selectedProduct?.power_attribute.power ?? '';
      clBcField.value = selectedProduct?.power_attribute.bc ?? '';
      clDiaField.value = selectedProduct?.power_attribute.dia ?? '';
      clCylField.value = selectedProduct?.power_attribute.cyl ?? '';
      clAxisField.value = selectedProduct?.power_attribute.axis ?? '';

      if (selectedProduct.discount > 0) {
            discountCheckDiv.style.display = 'block';
            discountValueText.innerHTML = '<h5>Discount available !</h5> Apply discount : ' + selectedProduct.discount + '%';
            discountValueField.value = selectedProduct.discount;
        } else {
            discountCheckDiv.style.display = 'none';
        }

        productPurchaseQtyField.addEventListener('input', function () {
            let purchaseQty = parseFloat(productPurchaseQtyField.value) || 0;
            let productTotal;
            if (discountCheckbox.checked) {
                // Apply discount if the checkbox is checked
                let discountPercentage = parseFloat(discountValueField.value) || 0;
                let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
                productTotal = purchaseQty * discountedPrice;
            } else {
                // No discount, use the original sale price
                productTotal = purchaseQty * parseFloat(selectedProduct.sale_price) || 0;
            }
            productProductTotalField.value = productTotal.toFixed(2);
        });

        discountCheckbox.addEventListener('change', function () {
            let isChecked = discountCheckbox.checked;
            if (isChecked) {
                let discountPercentage = parseFloat(discountValueField.value) || 0;
                let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
                productProductTotalField.value = (discountedPrice * productPurchaseQtyField.value).toFixed(2);
            } else {
                productProductTotalField.value = (selectedProduct.sale_price * productPurchaseQtyField.value).toFixed(2);
                productProductTotalField.innerHTML = '';
            }
        });
    }


    function updateRxContactLensProductFields(selectElement, cardIndex){
      let selectedProduct = contact_lens_list.find(product => product.product_id == selectElement.value);
      console.log(selectedProduct);
      let stockTypeField = document.querySelector(`[name='ContactLensStockType[${cardIndex}]']`);
      let lensPhysicalityField = document.querySelector(`[name='lens_physicality[${cardIndex}]']`);
      let lensDisposablilityField = document.querySelector(`[name='lens_disposablility[${cardIndex}]']`);
      let lensVisionTypeField = document.querySelector(`[name='vision_type[${cardIndex}]']`);
      let productBrandField = document.querySelector(`[name='product_brand[${cardIndex}]']`);
      let productHsnField = document.querySelector(`[name='product_hsn[${cardIndex}]']`);
      let productAvailableQtyField = document.querySelector(`[name='available_qty[${cardIndex}]']`);
      let productUnitPriceField = document.querySelector(`[name='unit_price[${cardIndex}]']`);
      let productPurchaseQtyField = document.querySelector(`[name='purchase_qty[${cardIndex}]']`);        let productProductTotalField = document.querySelector(`[name='product_total[${cardIndex}]']`);
      let productDiscountCheckedField = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
      let discountCheckDiv = document.getElementById('discount_check_div[' + cardIndex + ']');
      let discountValueText = document.getElementById('discount_value[' + cardIndex + ']');
      let discountValueField = document.getElementById('discount_value_field[' + cardIndex + ']');
      let discountCheckbox = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
      let productUnitTypeField = document.querySelector(`[name='unit_type[${cardIndex}]']`);
      let clPowerField = document.querySelector(`[name='cl_power[${cardIndex}]']`);
      let clBcField = document.querySelector(`[name='cl_bc[${cardIndex}]']`);
      let clDiaField = document.querySelector(`[name='cl_dia[${cardIndex}]']`);
      let clCylField = document.querySelector(`[name='cl_cylinder[${cardIndex}]']`);
      let clAxisField = document.querySelector(`[name='cl_axis[${cardIndex}]']`);
      let productCategoryIdField = document.querySelector(`[name='product_category_id[${cardIndex}]']`);

      stockTypeField.value = selectedProduct?.power_attribute.stock_type ?? '';
      lensPhysicalityField.value = selectedProduct?.power_attribute.contact_lens_type ?? '';
      lensDisposablilityField.value = selectedProduct?.power_attribute.contact_lens_disposability ?? '';
<!--      lensVisionTypeField.value = selectedProduct?.vision_type ?? '';-->
      productHsnField.value = selectedProduct?.hsn ?? '';
      productAvailableQtyField.value = selectedProduct?.product_quantity ?? '';
      productBrandField.value = selectedProduct?.brand_name ?? '';
      productUnitPriceField.value = selectedProduct?.sale_price ?? '';
      productUnitTypeField.value = selectedProduct?.unit_name ?? '';
      productCategoryIdField.value = selectedProduct?.category_id ?? '';


<!--      clPowerField.value = selectedProduct?.power_attribute.power ?? '';-->
<!--      clBcField.value = selectedProduct?.power_attribute.bc ?? '';-->
<!--      clDiaField.value = selectedProduct?.power_attribute.dia ?? '';-->
<!--      clCylField.value = selectedProduct?.power_attribute.cyl ?? '';-->
<!--      clAxisField.value = selectedProduct?.power_attribute.axis ?? '';-->

      if (selectedProduct.discount > 0) {
            discountCheckDiv.style.display = 'block';
            discountValueText.innerHTML = '<h5>Discount available !</h5> Apply discount : ' + selectedProduct.discount + '%';
            discountValueField.value = selectedProduct.discount;
        } else {
            discountCheckDiv.style.display = 'none';
        }

        productPurchaseQtyField.addEventListener('input', function () {
            let purchaseQty = parseFloat(productPurchaseQtyField.value) || 0;
            let productTotal;
            if (discountCheckbox.checked) {
                // Apply discount if the checkbox is checked
                let discountPercentage = parseFloat(discountValueField.value) || 0;
                let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
                productTotal = purchaseQty * discountedPrice;
            } else {
                // No discount, use the original sale price
                productTotal = purchaseQty * parseFloat(selectedProduct.sale_price) || 0;
            }
            productProductTotalField.value = productTotal.toFixed(2);
        });

        discountCheckbox.addEventListener('change', function () {
            let isChecked = discountCheckbox.checked;
            if (isChecked) {
                let discountPercentage = parseFloat(discountValueField.value) || 0;
                let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
                productProductTotalField.value = (discountedPrice * productPurchaseQtyField.value).toFixed(2);
            } else {
                productProductTotalField.value = (selectedProduct.sale_price * productPurchaseQtyField.value).toFixed(2);
                productProductTotalField.innerHTML = '';
            }
        });
    }


    function updateOtherProductFields(selectElement, cardIndex){
      let selectedProduct = other_products_list.find(product => product.product_id == selectElement.value);
      let productCategoryField = document.querySelector(`[name='product_category[${cardIndex}]']`);
      let productBrandField = document.querySelector(`[name='product_brand[${cardIndex}]']`);
      let productCategoryIdField = document.querySelector(`[name='product_category_id[${cardIndex}]']`);

      let productHsnField = document.querySelector(`[name='product_hsn[${cardIndex}]']`);
      let productAvailableQtyField = document.querySelector(`[name='available_qty[${cardIndex}]']`);
      let productUnitPriceField = document.querySelector(`[name='unit_price[${cardIndex}]']`);
      let productPurchaseQtyField = document.querySelector(`[name='purchase_qty[${cardIndex}]']`);
      let productProductTotalField = document.querySelector(`[name='product_total[${cardIndex}]']`);
      let productDiscountCheckedField = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
      let discountCheckDiv = document.getElementById('discount_check_div[' + cardIndex + ']');
      let discountValueText = document.getElementById('discount_value[' + cardIndex + ']');
      let discountValueField = document.getElementById('discount_value_field[' + cardIndex + ']');
      let discountCheckbox = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
      let productUnitTypeField = document.querySelector(`[name='unit_type[${cardIndex}]']`);

      productCategoryField.value = selectedProduct?.category_name ?? '';
      productHsnField.value = selectedProduct?.hsn ?? '';
      productAvailableQtyField.value = selectedProduct?.store_product_quantity ?? '';
      productBrandField.value = selectedProduct?.brand_name ?? '';
      productUnitPriceField.value = selectedProduct?.sale_price ?? '';
      productUnitTypeField.value = selectedProduct?.unit_name ?? '';
      productCategoryIdField.value = selectedProduct?.category_id ?? '';


      if (selectedProduct.discount > 0) {
            discountCheckDiv.style.display = 'block';
            discountValueText.innerHTML = '<h5>Discount available !</h5> Apply discount : ' + selectedProduct.discount + '%';
            discountValueField.value = selectedProduct.discount;
        } else {
            discountCheckDiv.style.display = 'none';
        }

        productPurchaseQtyField.addEventListener('input', function () {
            let purchaseQty = parseFloat(productPurchaseQtyField.value) || 0;
            let productTotal;
            if (discountCheckbox.checked) {
                // Apply discount if the checkbox is checked
                let discountPercentage = parseFloat(discountValueField.value) || 0;
                let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
                productTotal = purchaseQty * discountedPrice;
            } else {
                // No discount, use the original sale price
                productTotal = purchaseQty * parseFloat(selectedProduct.sale_price) || 0;
            }
            productProductTotalField.value = productTotal.toFixed(2);
        });

        discountCheckbox.addEventListener('change', function () {
            let isChecked = discountCheckbox.checked;
            if (isChecked) {
                let discountPercentage = parseFloat(discountValueField.value) || 0;
                let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
                productProductTotalField.value = (discountedPrice * productPurchaseQtyField.value).toFixed(2);
            } else {
                productProductTotalField.value = (selectedProduct.sale_price * productPurchaseQtyField.value).toFixed(2);
                productProductTotalField.innerHTML = '';
            }
        });

    }

</script>

<script>
    function getProductsData(){
        // Assuming products_container is the parent container
var productsContainer = document.getElementById('products_container');

// Check if the container exists
if (productsContainer) {
    // Get all product_widget elements inside products_container
    var productWidgets = productsContainer.getElementsByClassName('product_widget');

    // Initialize an array to store the product data
    var productsArray = [];

    // Loop through each product_widget element
    for (var i = 0; i < productWidgets.length; i++) {
        var productWidget = productWidgets[i];
        var productData = {};

        // Get all form elements (input, select, textarea) inside the current product_widget
        var formElements = productWidget.querySelectorAll('input, select, textarea');

        // Loop through each form element and extract key-value pairs
        formElements.forEach(function(formElement) {
            // Use the element's name attribute as the key and its value as the value
            productData[formElement.name] = formElement.value.trim();
        });

        // Add the product data to the array
        productsArray.push(productData);
    }

    let cartDataField = document.querySelector(`[name='cartData']`);
    // Now, productsArray contains the data of form elements inside all product_widgets
    console.log(productsArray);
    let jsonData = JSON.stringify(productsArray);
    cartDataField.value = jsonData;
  }
}

</script>


</body>

</html>