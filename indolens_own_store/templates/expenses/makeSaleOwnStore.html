<!DOCTYPE html>
<html dir="ltr" lang="en-US">

<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">


    <!-- ===============================================-->
    <!--    Document Title-->
    <!-- ===============================================-->
    <title>INDOLENS {{request.session.store_name}} - Make sale</title>
    {% load static %}


    <!-- ===============================================-->
    <!--    Favicons-->
    <!-- ===============================================-->
    <link href="{% static 'img/favicons/apple-touch-icon.png' %}" rel="apple-touch-icon" sizes="180x180">
    <link href="{% static 'img/favicons/favicon-32x32.png' %}" rel="icon" sizes="32x32" type="image/png">
    <link href="{% static 'img/favicons/favicon-16x16.png' %}" rel="icon" sizes="16x16" type="image/png">
    <link href="{% static 'img/favicons/favicon.ico' %}" rel="shortcut icon" type="image/x-icon">
    <link href="{% static 'img/favicons/manifest.json' %}" rel="manifest">
    <meta content="{% static 'img/favicons/mstile-150x150.png' %}" name="msapplication-TileImage">
    <meta content="#ffffff" name="theme-color">
    <script src="{% static 'vendors/imagesloaded/imagesloaded.pkgd.min.js' %}"></script>
    <script src="{% static 'vendors/simplebar/simplebar.min.js' %}"></script>
    <script src="{% static 'js/config.js' %}"></script>

    <!-- ===============================================-->
    <!--    Stylesheets-->
    <!-- ===============================================-->
    <link href="{% static 'vendors/flatpickr/flatpickr.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendors/choices/choices.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendors/prism/prism-okaidia.css' %}" rel="stylesheet">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&amp;display=swap"
          rel="stylesheet">
    <link href="{% static 'vendors/simplebar/simplebar.min.css' %}" rel="stylesheet">
    <link href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" rel="stylesheet">
    <link href="{% static 'css/theme-rtl.min.css' %}" id="style-rtl" rel="stylesheet" type="text/css">
    <link href="{% static 'css/theme.min.css' %}" id="style-default" rel="stylesheet" type="text/css">
    <link href="{% static 'css/user-rtl.min.css' %}" id="user-style-rtl" rel="stylesheet" type="text/css">
    <link href="{% static 'css/user.min.css' %}" id="user-style-default" rel="stylesheet" type="text/css">

    <style>
     table {
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      border: 1px solid #dddddd;
      text-align: left;
      padding: 8px;
    }

    th {
      background-color: #f2f2f2;
          font-weight: bold; /* Add this line to make the text bold */
    }

    #preview {
      margin-top: 20px;
    }

     /* Add responsive styling for smaller screens */
    @media only screen and (max-width: 600px) {
        table {
            width: 100%;
            overflow-x: auto;
            display: block;
        }

        th, td {
            white-space: nowrap;
        }
    }

        /* Add some basic styling to the table */
.product-category-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px; /* Add some margin to separate tables */
}

/* Style for table header cells */
.product-category-table th {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
}

/* Style for table data cells */
.product-category-table td {
    border: 1px solid #ddd;
    padding: 8px;
}

.mb2 h6 {
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

    </style>
    <script>
      var isRTL = JSON.parse(localStorage.getItem('isRTL'));
      if (isRTL) {
        var linkDefault = document.getElementById('style-default');
        var userLinkDefault = document.getElementById('user-style-default');
        linkDefault.setAttribute('disabled', true);
        userLinkDefault.setAttribute('disabled', true);
        document.querySelector('html').setAttribute('dir', 'rtl');
      } else {
        var linkRTL = document.getElementById('style-rtl');
        var userLinkRTL = document.getElementById('user-style-rtl');
        linkRTL.setAttribute('disabled', true);
        userLinkRTL.setAttribute('disabled', true);
      }
    </script>
</head>


<body>

<!-- ===============================================-->
<!--    Main Content-->
<!-- ===============================================-->
<main class="main" id="top">
    <div class="container-fluid px-0">
        {% include 'nav_bar_store.html' %}

        <div class="content">
            <form id="saleForm" action="{% url 'own_store_make_sale' %}" method="post">
                {% csrf_token %}

                <input type="hidden" name="cartData">
                <input type="hidden" name="customerData">
                <input type="hidden" name="billingDetailsData">
                <input type="hidden" id="linkedData" name="linkedData">
            </form>
            <div class="col-12">
                <div class="card shadow-none border border-300 my-4" data-component-card="data-component-card">
                    <div class="card-header p-4 border-bottom border-300 bg-soft">
                        <div class="row g-3 justify-content-between align-items-center">
                            <div class="col-12 col-md">
                                <h4 class="text-900 mb-0">Make a sale</h4>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="p-4 code-to-copy">
                            <div class="card theme-wizard mb-5" data-theme-wizard="data-theme-wizard">
                                <div class="card-header bg-100 pt-3 pb-2 border-bottom-0">
                                    <ul class="nav justify-content-between nav-wizard">
                                        <!--                                                                commented in a tag below                                        data-bs-toggle="tab"-->

                                        <li class="nav-item"><a class="nav-link active fw-semi-bold"
                                                                href="#bootstrap-wizard-validation-tab1"
                                                                data-wizard-step="1">
                                            <div class="text-center d-inline-block"><span
                                                    class="nav-item-circle-parent"><span class="nav-item-circle"><span
                                                    class="fas fa-shopping-cart"></span></span></span><span
                                                    class="d-none d-md-block mt-1 fs--1">Products</span></div>
                                        </a></li>

                                        <li class="nav-item"><a class="nav-link fw-semi-bold"
                                                                href="#bootstrap-wizard-validation-tab2"
                                                                data-wizard-step="2">
                                            <div class="text-center d-inline-block"><span
                                                    class="nav-item-circle-parent"><span class="nav-item-circle"><span
                                                    class="fas fa-user"></span></span></span><span
                                                    class="d-none d-md-block mt-1 fs--1">Customer</span></div>
                                        </a></li>
                                        <li class="nav-item"><a class="nav-link fw-semi-bold"
                                                                href="#bootstrap-wizard-validation-tab3"
                                                                data-wizard-step="3">
                                            <div class="text-center d-inline-block"><span
                                                    class="nav-item-circle-parent"><span class="nav-item-circle"><span
                                                    class="fas fa-file-invoice-dollar"></span></span></span><span
                                                    class="d-none d-md-block mt-1 fs--1">Billing details</span></div>
                                        </a></li>

                                        <li class="nav-item"><a class="nav-link fw-semi-bold"
                                                                href="#bootstrap-wizard-validation-tab4"
                                                                data-wizard-step="4">
                                            <div class="text-center d-inline-block"><span
                                                    class="nav-item-circle-parent"><span class="nav-item-circle"><span
                                                    class="fas fa-eye"></span></span></span><span
                                                    class="d-none d-md-block mt-1 fs--1">Review</span></div>
                                        </a></li>
                                    </ul>
                                </div>

                                <div class="card-body pt-4 pb-0">
                                    <div class="tab-content">
                                        <!--                            tab 1-->
                                        <div class="tab-pane active" role="tabpanel"
                                             aria-labelledby="bootstrap-wizard-validation-tab1"
                                             id="bootstrap-wizard-validation-tab1">
                                            <form class="needs-validation" id="wizardValidationForm1"
                                                  novalidate="novalidate" data-wizard-form="1"
                                                  onchange="getProductsData()">
                                                <div id="products_container">
                                                    <!--                                                    add product here-->
                                                </div>
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="btn-group me-1 float-end">
                                                            <button class="btn dropdown-toggle mb-1 btn-primary"
                                                                    type="button" data-bs-toggle="dropdown"
                                                                    aria-haspopup="true" aria-expanded="false">Add
                                                                Product
                                                            </button>
                                                            <div class="dropdown-menu">
                                                                <a type="button" onclick="addLensContainer()"
                                                                   class="dropdown-item">Add a Lens</a>
                                                                <!--                                                                <a type="button" onclick="addStockContactLensContainer()" class="dropdown-item">Add Stock Contact Lens</a>-->
                                                                <a type="button" onclick="addRxContactLensContainer()"
                                                                   class="dropdown-item">Add Contact Lens</a>
                                                                <a type="button" onclick="addOtherProductsContainer()"
                                                                   class="dropdown-item">Add Other Products</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="tab-pane" role="tabpanel"
                                             aria-labelledby="bootstrap-wizard-validation-tab2"
                                             id="bootstrap-wizard-validation-tab2">
                                            <form class="needs-validation" id="wizardValidationForm2"
                                                  novalidate="novalidate" data-wizard-form="2">
                                                <div class="card-header bg-100 mb-4">
                                                    <h5 class="mb-3">Old customer? Choose from Below</h5>
                                                    <select onchange="updateCustomerFields(this)"
                                                            class="form-select" data-choices="data-choices"
                                                            data-options='{"removeItemButton":true,"placeholder":true}'
                                                            name="customers">
                                                        <option value="">Select Customer</option>
                                                        {% for customer in customers_list %}
                                                        <option value="{{customer.phone}}">
                                                            {{customer.phone}}
                                                        </option>
                                                        {% endfor %}
                                                    </select>
                                                    <h5 class="mb-3">New customer? Continue adding them</h5>
                                                    <div id="customer_info" class="row g-3 mb-3">
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">Customer Name</h5>
                                                            <input class="form-control"
                                                                   name="customer_name"
                                                                   placeholder="Name" maxlength="70"
                                                                   required="required"
                                                                   onchange="genCustomerObject()"
                                                                   type="text" value=""
                                                                   oninput="this.value = this.value.replace(/[^a-zA-Z\s]/g, '');"/>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">Customer Email</h5>
                                                            <input class="form-control"
                                                                   name="customer_email"
                                                                   placeholder="Email"
                                                                   required="required"
                                                                   onchange="genCustomerObject()"
                                                                   type="email" value=""/>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">Customer Phone</h5>
                                                            <input class="form-control"
                                                                   name="customer_phone"
                                                                   placeholder="Phone"
                                                                   required="required"
                                                                   onchange="genCustomerObject()"
                                                                   min="1111111111" max="9999999999"
                                                                   type="number" value=""/>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">Customer Age</h5>
                                                            <input class="form-control"
                                                                   name="customer_age"
                                                                   placeholder="Age"
                                                                   required="required"
                                                                   onchange="genCustomerObject()"
                                                                   type="number" min="1" max="150" value=""/>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">Gender</h5>
                                                            <select
                                                                    onchange="genCustomerObject()"
                                                                    name="customer_gender" class="form-select"
                                                                    aria-label="Default select example"
                                                                    required="required">
                                                                <option value="" selected>Please select Gender</option>
                                                                <option value="M">Male</option>
                                                                <option value="F">Female</option>
                                                                <option value="Others">Others</option>
                                                            </select>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-6">
                                                            <h5 class="mb-3">City</h5>
                                                            <input class="form-control"
                                                                   name="customer_city"
                                                                   placeholder="City"
                                                                   required="required"
                                                                   onchange="genCustomerObject()"
                                                                   oninput="this.value = this.value.replace(/[^a-zA-Z\s]/g, '');"
                                                                   type="text" value=""/>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-12">
                                                            <h5 class="mb-3">Language</h5>
                                                            <select

                                                                    onchange="genCustomerObject()"

                                                                    name="customer_language" class="form-select"
                                                                    aria-label="Default select example"
                                                                    required="required">
                                                                <option value="" selected="selected">Please select
                                                                    Language
                                                                </option>
                                                                <option value="English">English</option>
                                                                <option value="Kannada">Kannada</option>
                                                                <option value="Hindi">Hindi</option>
                                                                <option value="Tamil">Tamil</option>
                                                                <option value="Telugu">Telugu</option>
                                                                <option value="Malayalam">Malayalam</option>
                                                                <option value="Marathi">Marathi</option>
                                                                <option value="Gujarati">Gujarati</option>
                                                            </select>
                                                            <div class="invalid-feedback">This field is required.</div>
                                                        </div>
                                                        <div class="mb2 col-12">
                                                            <h5 class="mb-3">Customer Address</h5>
                                                            <textarea
                                                                    onchange="genCustomerObject()"

                                                                    name="customer_address" class="form-control"
                                                                    rows="3" required="required"></textarea>
                                                        </div>


                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="tab-pane" role="tabpanel"
                                             aria-labelledby="bootstrap-wizard-validation-tab3"
                                             id="bootstrap-wizard-validation-tab3">
                                            <form class="mb-2 needs-validation" id="wizardValidationForm3"
                                                  novalidate="novalidate" data-wizard-form="3">
                                                <div class="row g-3 mb-3">
                                                    <div class="mb2 col-6">
                                                        <h5 id="totalProducts" class="mb-3">Total Items:</h5>
                                                    </div>
                                                    <div class="mb2 col-6">
                                                        <h5 id="totalSum" class="mb-3">Billing Amount:</h5>
                                                    </div>
                                                </div>

                                                <div id="billing_info" class="row g-3 mb-3">

                                                    <div class="mb2 col-6">
                                                        <h5 class="mb-3">Order Placed By</h5>
                                                        <select
                                                                onchange="genBillingInfoObject()"
                                                                name="orderByEmployee" class="form-select"
                                                                aria-label="Default select example"
                                                                required="required">
                                                            <option value="" selected>Please select employee</option>
                                                            {% for employee in employee_list %}
                                                            <option value="{{employee.employee_id}}">{{employee.name}}
                                                            </option>
                                                            {% endfor %}
                                                        </select>
                                                        <div class="invalid-feedback">This field is required.</div>
                                                    </div>
                                                    <div class="mb2 col-6">
                                                        <h5 class="mb-3">Choose Lab</h5>
                                                        <select
                                                                onchange="genBillingInfoObject()"
                                                                name="assignedLab" class="form-select"
                                                                aria-label="Default select example"
                                                                required="required">
                                                            <option value="0" selected>Please select lab</option>
                                                            {% for lab in lab_list %}
                                                            <option value="{{lab.lab_id}}">{{lab.lab_name}}</option>
                                                            {% endfor %}
                                                        </select>
                                                        <div class="invalid-feedback">This field is required.</div>
                                                    </div>

                                                    <div class="mb2 col-6">
                                                        <h5 class="mb-3">Estimated Delivery Date</h5>
                                                        <input
                                                                onchange="genBillingInfoObject()"
                                                                name="estDeliveryDate"
                                                                class="form-control datetimepicker flatpickr-input"
                                                                id="datePicker"
                                                                type="text"
                                                                placeholder="dd/mm/yyyy"
                                                                data-options="{&quot;disableMobile&quot;:true,&quot;dateFormat&quot;:&quot;d/m/Y&quot;}"
                                                                readonly="readonly"
                                                        >
                                                        <div class="invalid-feedback">This field is required.</div>
                                                    </div>
                                                    <div class="mb2 col-6">
                                                        <h5 class="mb-3">Advance Amount Paid(₹)</h5>
                                                        <input
                                                                onchange="genBillingInfoObject()"
                                                                required
                                                                name="amount_paid"
                                                                class="form-control"
                                                                type="number" min="0" value="0" placeholder="&#8377;">
                                                        <div class="invalid-feedback">This field is required and should be less than billing amount.</div>
                                                    </div>
                                                    <div class="mb2 col-6">
                                                        <h5 class="mb-3">Payment Mode</h5>
                                                        <select
                                                                onchange="genBillingInfoObject()"
                                                                name="payment_mode" class="form-select"
                                                                aria-label="Default select example" disabled
                                                                required="required">
                                                            <option value="" selected>Please select payment mode</option>
                                                            <option value="1"> CASH </option>
                                                            <option value="2"> UPI </option>
                                                            <option value="3"> DEBIT CARD </option>
                                                            <option value="4"> CREDIT CARD </option>
                                                        </select>
                                                        <div class="invalid-feedback">This field is required when advance amount paid.</div>
                                                    </div>


                                                </div>

                                                                                <div id="category1Container"></div>


                                                <div class="mb2 col-12 mt-3">
                                                    <h5 class="mb-3">Sale notes</h5>

                                                    <textarea
                                                            required
                                                            onchange="genBillingInfoObject()"
                                                            name="sale_note" class="form-control" id="exampleTextarea"
                                                            rows="3"></textarea>
                                                    <div class="invalid-feedback">This field is required.</div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="tab-pane" role="tabpanel"
                                             aria-labelledby="bootstrap-wizard-validation-tab4"
                                             id="bootstrap-wizard-validation-tab4">
                                            <h5 class="mb-3">Draft Invoice</h5>
                                            <!--                                            customer details start-->
                                            <div id="preview"></div>

                                            <!--                                            customer details end-->

                                            <button class="mt-3 btn btn-primary w-100 mb-3" id="confirmSale">Confirm
                                                Sale
                                            </button>

                                        </div>

                                    </div>
                                </div>
                                <div class="card-footer border-top-0" data-wizard-footer="data-wizard-footer">
                                    <div class="d-flex pager wizard list-inline mb-0">
                                        <button class="d-none btn btn-link ps-0" type="button"
                                                data-wizard-prev-btn="data-wizard-prev-btn"><span
                                                class="fas fa-chevron-left me-1" data-fa-transform="shrink-3"></span>Previous
                                        </button>
                                        <div class="flex-1 text-end">
                                            <button class="btn btn-primary px-6 px-sm-6" type="submit"
                                                    data-wizard-next-btn="data-wizard-next-btn">Next<span
                                                    class="fas fa-chevron-right ms-1"
                                                    data-fa-transform="shrink-3"> </span></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            {% include 'footer.html' %}
        </div>
    </div>

    <script>
        var navbarTopStyle = localStorage.getItem('phoenixNavbarTopStyle');
        var navbarTop = document.querySelector('.navbar-top');
        if (navbarTopStyle === 'darker') {
          navbarTop.classList.add('navbar-darker');
        }

        var navbarVerticalStyle = localStorage.getItem('phoenixNavbarVerticalStyle');
        var navbarVertical = document.querySelector('.navbar-vertical');
        if (navbarVerticalStyle === 'darker') {
          navbarVertical.classList.add('navbar-darker');
        }



    </script>
</main>
<!-- ===============================================-->
<!--    End of Main Content-->
<!-- ===============================================-->

<!-- ===============================================-->
<!--    JavaScripts-->
<!-- ===============================================-->
<script src="{% static 'vendors/popper/popper.min.js' %}"></script>
<script src="{% static 'vendors/bootstrap/bootstrap.min.js' %}"></script>
<script src="{% static 'vendors/anchorjs/anchor.min.js' %}"></script>
<script src="{% static 'vendors/is/is.min.js' %}"></script>
<script src="{% static 'vendors/fontawesome/all.min.js' %}"></script>
<script src="{% static 'vendors/lodash/lodash.min.js' %}"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=window.scroll"></script>
<script src="{% static 'vendors/list.js/list.min.js' %}"></script>
<script src="{% static 'vendors/feather-icons/feather.min.js' %}"></script>
<script src="{% static 'vendors/dayjs/dayjs.min.js' %}"></script>
<script src="{% static 'vendors/choices/choices.min.js' %}"></script>
<script src="{% static 'vendors/prism/prism.js' %}"></script>
<script src="{% static 'js/phoenix.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        flatpickr("#datePicker", {
            dateFormat: "d/m/Y",
            disableMobile: true,
            minDate: "today",
            defaultDate: new Date().fp_incr(3)
        });
    });
</script>

{{ lens_list|json_script:"lensList" }}
{{ contact_lens_list|json_script:"contactLensList" }}
{{ rx_contact_lens_list|json_script:"rxContactLensList" }}
{{ other_products_list|json_script:"otherProductsList" }}
{{ customers_list|json_script:"customersList" }}
<script>

let productCardCount = 1;
var lens_list = JSON.parse(document.getElementById('lensList').textContent);
var contact_lens_list = JSON.parse(document.getElementById('contactLensList').textContent);
var rx_contact_lens_list = JSON.parse(document.getElementById('rxContactLensList').textContent);
var other_products_list = JSON.parse(document.getElementById('otherProductsList').textContent);
var customers_list = JSON.parse(document.getElementById('customersList').textContent);

function addLensContainer() {
    let lensProductCard = document.createElement("div");
    lensProductCard.classList.add("product_widget", "card-header", "bg-100", "mb-4");
    lensProductCard.innerHTML = `
    <div class="col text-end">
        <a onclick="removeProductCard(this)" type="button" class="text-danger">
            Remove <i class="fas fa-trash"></i>
        </a>
    </div>
    <div class="mb-3 col-12">
        <h6 class="mb-3">Select Lens</h6>
        <select onchange="updateLensProductFields(this, ${productCardCount})" class="form-select" data-choices="data-choices" data-options='{"removeItemButton":true,"placeholder":true}'
            name="product" required="required">
            <option value="">Select Lens</option>
            {% for product in lens_list %}
            <option value="{{product.product_id}}">
                {{product.product_name}}
            </option>
            {% endfor %}
        </select>
        <div class="custom-error" style="color: red;"></div>
    </div>
    <input name ="product_category[${productCardCount}]" id="product_category" type="hidden"/>
    <div class="row g-3 mb-3">
        <div class="mb2 col-4">
            <h6 class="mb-3">Vision Type</h6>
            <input class="form-control" name="lens_type[${productCardCount}]" placeholder="Lens Type" required="required" type="text" value=""
                readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Product Brand</h6>
            <input class="form-control" name="product_brand[${productCardCount}]" placeholder="Brand" required="required" type="text" value=""
                readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <!-- Add the rest of your product card HTML structure here -->
        <div class="mb2 col-4">
            <h6 class="mb-3">Product HSN</h6>
            <input class="form-control" name="product_hsn[${productCardCount}]" placeholder="HSN" required="required" type="text" value=""
                readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Available Quantity</h6>
            <input class="form-control" name="available_qty[${productCardCount}]" placeholder="Available Quantity" required="required"
                type="text" value="" readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Unit Price(₹)</h6>
            <input class="form-control" name="unit_price[${productCardCount}]" placeholder="Unit Price" required="required" type="text" value=""
                readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Unit Type</h6>
            <input class="form-control" name="unit_type[${productCardCount}]" placeholder="Unit Type" required="required" type="text" value=""
                readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Type</h6>
            <input readonly class="form-control" name="stock_type[${productCardCount}]" placeholder="Rx/Stock" required="required" min="1"
                type="text" value="" />
            <div class="invalid-feedback">This field should be 1 in
                minimum and should be less than available quantity.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Index</h6>
            <input readonly class="form-control" name="lens_index[${productCardCount}]" placeholder="Index value" required="required" min="1"
                type="text" value="" />
            <div class="invalid-feedback">This field should not be empty..
            </div>
        </div>

        <input class="form-control"
                   name="product_category_id[${productCardCount}]"
                   placeholder="Category"
                   required="required"
                   hidden
                   type="text" value="" readonly/>
        <input class="form-control"
                   name="product_name[${productCardCount}]"
                   placeholder="Name"
                   required="required"
                   hidden
                   type="text" value="" readonly/>
        <div class="mb2 col-4">
            <h6 class="mb-3">Purchase Quantity</h6>
            <input class="form-control" name="purchase_qty[${productCardCount}]" placeholder="Purchase quantity" required="required" min="1"
                type="number" value="" />
            <div class="invalid-feedback">This field should be 1 in
                minimum and should be less than available quantity.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Product Total</h6>
            <input class="form-control" name="product_total[${productCardCount}]" placeholder="Product Total" required="required" type="text"
                value="0" readonly />
            <div class="invalid-feedback">This field is required.
            </div>
        </div>

    </div>
    <div class="mb-3 col-6" id="discount_check_div[${productCardCount}]" style="display:none">
            <input id="discount_value_field[${productCardCount}]" type="hidden" class="form-check" name="discount_percentage[${productCardCount}]" required="required"
                readonly />
            <input class="form-check-input" type="checkbox" name="discount_checked[${productCardCount}]"
                id="bootstrap-wizard-validation-wizard-checkbox[${productCardCount}]" value="off"/>
            <label id="discount_value[${productCardCount}]" class="form-check-label text-900"
                for="bootstrap-wizard-validation-wizard-checkbox[${productCardCount}]"></label>
        </div>
    <div class="dropdown-divider"></div>
    <h6 class="mb-3">Power attributes</h6>
    <div class="row mb-3 stock_power_card[${productCardCount}]" id="stock_power_card[${productCardCount}]" style="display:none">
        <div class="col-12">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">EYE</th>
                        <th scope="col">SPH</th>
                        <th scope="col">CYL</th>
                        <th scope="col">AXIS</th>
                        <th scope="col">ADD</th>
                        <th scope="col">PD</th>
                    </tr>
                </thead>
                <tbody class="stock_power_card_table[${productCardCount}]" id="stock_power_card_table[${productCardCount}]">

                    <tr>
                        <th scope="row">Right</th>
                        <td class="col-auto col-lg-2">
                            <select name="rightLensSphStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="-20.00">-20.00</option>
                                <option value="-19.75">-19.75</option>
                                <option value="-19.50">-19.50</option>
                                <option value="-19.25">-19.25</option>
                                <option value="-19.00">-19.00</option>
                                <option value="-18.75">-18.75</option>
                                <option value="-18.50">-18.50</option>
                                <option value="-18.25">-18.25</option>
                                <option value="-18.00">-18.00</option>
                                <option value="-17.75">-17.75</option>
                                <option value="-17.50">-17.50</option>
                                <option value="-17.25">-17.25</option>
                                <option value="-17.00">-17.00</option>
                                <option value="-16.75">-16.75</option>
                                <option value="-16.50">-16.50</option>
                                <option value="-16.25">-16.25</option>
                                <option value="-16.00">-16.00</option>
                                <option value="-15.75">-15.75</option>
                                <option value="-15.50">-15.50</option>
                                <option value="-15.25">-15.25</option>
                                <option value="-15.00">-15.00</option>
                                <option value="-14.75">-14.75</option>
                                <option value="-14.50">-14.50</option>
                                <option value="-14.25">-14.25</option>
                                <option value="-14.00">-14.00</option>
                                <option value="-13.75">-13.75</option>
                                <option value="-13.50">-13.50</option>
                                <option value="-13.25">-13.25</option>
                                <option value="-13.00">-13.00</option>
                                <option value="-12.75">-12.75</option>
                                <option value="-12.50">-12.50</option>
                                <option value="-12.25">-12.25</option>
                                <option value="-12.00">-12.00</option>
                                <option value="-11.75">-11.75</option>
                                <option value="-11.50">-11.50</option>
                                <option value="-11.25">-11.25</option>
                                <option value="-11.00">-11.00</option>
                                <option value="-10.75">-10.75</option>
                                <option value="-10.50">-10.50</option>
                                <option value="-10.25">-10.25</option>
                                <option value="-10.00">-10.00</option>
                                <option value="-9.75">-9.75</option>
                                <option value="-9.50">-9.50</option>
                                <option value="-9.25">-9.25</option>
                                <option value="-9.00">-9.00</option>
                                <option value="-8.75">-8.75</option>
                                <option value="-8.50">-8.50</option>
                                <option value="-8.25">-8.25</option>
                                <option value="-8.00">-8.00</option>
                                <option value="-7.75">-7.75</option>
                                <option value="-7.50">-7.50</option>
                                <option value="-7.25">-7.25</option>
                                <option value="-7.00">-7.00</option>
                                <option value="-6.75">-6.75</option>
                                <option value="-6.50">-6.50</option>
                                <option value="-6.25">-6.25</option>
                                <option value="-6.00">-6.00</option>
                                <option value="-5.75">-5.75</option>
                                <option value="-5.50">-5.50</option>
                                <option value="-5.25">-5.25</option>
                                <option value="-5.00">-5.00</option>
                                <option value="-4.75">-4.75</option>
                                <option value="-4.50">-4.50</option>
                                <option value="-4.25">-4.25</option>
                                <option value="-4.00">-4.00</option>
                                <option value="-3.75">-3.75</option>
                                <option value="-3.50">-3.50</option>
                                <option value="-3.25">-3.25</option>
                                <option value="-3.00">-3.00</option>
                                <option value="-2.75">-2.75</option>
                                <option value="-2.50">-2.50</option>
                                <option value="-2.25">-2.25</option>
                                <option value="-2.00">-2.00</option>
                                <option value="-1.75">-1.75</option>
                                <option value="-1.50">-1.50</option>
                                <option value="-1.25">-1.25</option>
                                <option value="-1.00">-1.00</option>
                                <option value="-0.75">-0.75</option>
                                <option value="-0.50">-0.50</option>
                                <option value="-0.25">-0.25</option>
                                <option value="0.25">0.25</option>
                                <option value="0.50">0.50</option>
                                <option value="0.75">0.75</option>
                                <option value="1.00">1.00</option>
                                <option value="1.25">1.25</option>
                                <option value="1.50">1.50</option>
                                <option value="1.75">1.75</option>
                                <option value="2.00">2.00</option>
                                <option value="2.25">2.25</option>
                                <option value="2.50">2.50</option>
                                <option value="2.75">2.75</option>
                                <option value="3.00">3.00</option>
                                <option value="3.25">3.25</option>
                                <option value="3.50">3.50</option>
                                <option value="3.75">3.75</option>
                                <option value="4.00">4.00</option>
                                <option value="4.25">4.25</option>
                                <option value="4.50">4.50</option>
                                <option value="4.75">4.75</option>
                                <option value="5.00">5.00</option>
                                <option value="5.25">5.25</option>
                                <option value="5.50">5.50</option>
                                <option value="5.75">5.75</option>
                                <option value="6.00">6.00</option>
                                <option value="6.25">6.25</option>
                                <option value="6.50">6.50</option>
                                <option value="6.75">6.75</option>
                                <option value="7.00">7.00</option>
                                <option value="7.25">7.25</option>
                                <option value="7.50">7.50</option>
                                <option value="7.75">7.75</option>
                                <option value="8.00">8.00</option>
                                <option value="8.25">8.25</option>
                                <option value="8.50">8.50</option>
                                <option value="8.75">8.75</option>
                                <option value="9.00">9.00</option>
                                <option value="9.25">9.25</option>
                                <option value="9.50">9.50</option>
                                <option value="9.75">9.75</option>
                                <option value="10.00">10.00</option>
                                <option value="10.25">10.25</option>
                                <option value="10.50">10.50</option>
                                <option value="10.75">10.75</option>
                                <option value="11.00">11.00</option>
                                <option value="11.25">11.25</option>
                                <option value="11.50">11.50</option>
                                <option value="11.75">11.75</option>
                                <option value="12.00">12.00</option>
                                <option value="12.25">12.25</option>
                                <option value="12.50">12.50</option>
                                <option value="12.75">12.75</option>
                                <option value="13.00">13.00</option>
                                <option value="13.25">13.25</option>
                                <option value="13.50">13.50</option>
                                <option value="13.75">13.75</option>
                                <option value="14.00">14.00</option>
                                <option value="14.25">14.25</option>
                                <option value="14.50">14.50</option>
                                <option value="14.75">14.75</option>
                                <option value="15.00">15.00</option>
                                <option value="15.25">15.25</option>
                                <option value="15.50">15.50</option>
                                <option value="15.75">15.75</option>
                                <option value="16.00">16.00</option>
                                <option value="16.25">16.25</option>
                                <option value="16.50">16.50</option>
                                <option value="16.75">16.75</option>
                                <option value="17.00">17.00</option>
                                <option value="17.25">17.25</option>
                                <option value="17.50">17.50</option>
                                <option value="17.75">17.75</option>
                                <option value="18.00">18.00</option>
                                <option value="18.25">18.25</option>
                                <option value="18.50">18.50</option>
                                <option value="18.75">18.75</option>
                                <option value="19.00">19.00</option>
                                <option value="19.25">19.25</option>
                                <option value="19.50">19.50</option>
                                <option value="19.75">19.75</option>
                                <option value="20.00">20.00</option>

                            </select>
                                        <div class="invalid-feedback">This field is required.</div>

                        </td>
                        <td class="col-auto col-lg-2">
                            <select required name="rightLensCylStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="-0.25">-0.25</option>
                                <option value="-0.50">-0.50</option>
                                <option value="-0.75">-0.75</option>
                                <option value="-1.00">-1.00</option>
                                <option value="-1.25">-1.25</option>
                                <option value="-1.50">-1.50</option>
                                <option value="-1.75">-1.75</option>
                                <option value="-2.00">-2.00</option>
                                <option value="-2.25">-2.25</option>
                                <option value="-2.50">-2.50</option>
                                <option value="-2.75">-2.75</option>
                                <option value="-3.00">-3.00</option>
                                <option value="-3.25">-3.25</option>
                                <option value="-3.50">-3.50</option>
                                <option value="-3.75">-3.75</option>
                                <option value="-4.00">-4.00</option>
                                <option value="-4.25">-4.25</option>
                                <option value="-4.50">-4.50</option>
                                <option value="-4.75">-4.75</option>
                                <option value="-5.00">-5.00</option>
                                <option value="-5.25">-5.25</option>
                                <option value="-5.50">-5.50</option>
                                <option value="-5.75">-5.75</option>
                                <option value="-6.00">-6.00</option>
                            </select>
                                        <div class="invalid-feedback">This field is required.
                        </td>
                        <td class="col-auto col-lg-2">
                            <select required name="rightLensAxisStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="15">15</option>
                                <option value="20">20</option>
                                <option value="25">25</option>
                                <option value="30">30</option>
                                <option value="35">35</option>
                                <option value="40">40</option>
                                <option value="45">45</option>
                                <option value="50">50</option>
                                <option value="55">55</option>
                                <option value="60">60</option>
                                <option value="65">65</option>
                                <option value="70">70</option>
                                <option value="75">75</option>
                                <option value="80">80</option>
                                <option value="85">85</option>
                                <option value="90">90</option>
                                <option value="95">95</option>
                                <option value="100">100</option>
                                <option value="105">105</option>
                                <option value="110">110</option>
                                <option value="115">115</option>
                                <option value="120">120</option>
                                <option value="125">125</option>
                                <option value="130">130</option>
                                <option value="135">135</option>
                                <option value="140">140</option>
                                <option value="145">145</option>
                                <option value="150">150</option>
                                <option value="155">155</option>
                                <option value="160">160</option>
                                <option value="165">165</option>
                                <option value="170">170</option>
                                <option value="175">175</option>
                                <option value="180">180</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <select required name="rightLensAddStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="+1.00">+1.00</option>
                                <option value="+1.25">+1.25</option>
                                <option value="+1.50">+1.50</option>
                                <option value="+1.75">+1.75</option>
                                <option value="+2.00">+2.00</option>
                                <option value="+.2.25">+.2.25</option>
                                <option value="+2.50">+2.50</option>
                                <option value="+2.75">+2.75</option>
                                <option value="+3.00">+3.00</option>
                                <option value="+3.50">+3.50</option>
                                <option value="+4.00">+4.00</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                        <input required name="rightLensPdStock[${productCardCount}]" class="form-control" aria-label="Default select example"
                            placeholder = "PD value"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>

                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                    </tr>

                     <tr>
                        <th scope="row">Left</th>
                        <td class="col-auto col-lg-2">
                            <select required name="leftLensSphStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="-20.00">-20.00</option>
                                <option value="-19.75">-19.75</option>
                                <option value="-19.50">-19.50</option>
                                <option value="-19.25">-19.25</option>
                                <option value="-19.00">-19.00</option>
                                <option value="-18.75">-18.75</option>
                                <option value="-18.50">-18.50</option>
                                <option value="-18.25">-18.25</option>
                                <option value="-18.00">-18.00</option>
                                <option value="-17.75">-17.75</option>
                                <option value="-17.50">-17.50</option>
                                <option value="-17.25">-17.25</option>
                                <option value="-17.00">-17.00</option>
                                <option value="-16.75">-16.75</option>
                                <option value="-16.50">-16.50</option>
                                <option value="-16.25">-16.25</option>
                                <option value="-16.00">-16.00</option>
                                <option value="-15.75">-15.75</option>
                                <option value="-15.50">-15.50</option>
                                <option value="-15.25">-15.25</option>
                                <option value="-15.00">-15.00</option>
                                <option value="-14.75">-14.75</option>
                                <option value="-14.50">-14.50</option>
                                <option value="-14.25">-14.25</option>
                                <option value="-14.00">-14.00</option>
                                <option value="-13.75">-13.75</option>
                                <option value="-13.50">-13.50</option>
                                <option value="-13.25">-13.25</option>
                                <option value="-13.00">-13.00</option>
                                <option value="-12.75">-12.75</option>
                                <option value="-12.50">-12.50</option>
                                <option value="-12.25">-12.25</option>
                                <option value="-12.00">-12.00</option>
                                <option value="-11.75">-11.75</option>
                                <option value="-11.50">-11.50</option>
                                <option value="-11.25">-11.25</option>
                                <option value="-11.00">-11.00</option>
                                <option value="-10.75">-10.75</option>
                                <option value="-10.50">-10.50</option>
                                <option value="-10.25">-10.25</option>
                                <option value="-10.00">-10.00</option>
                                <option value="-9.75">-9.75</option>
                                <option value="-9.50">-9.50</option>
                                <option value="-9.25">-9.25</option>
                                <option value="-9.00">-9.00</option>
                                <option value="-8.75">-8.75</option>
                                <option value="-8.50">-8.50</option>
                                <option value="-8.25">-8.25</option>
                                <option value="-8.00">-8.00</option>
                                <option value="-7.75">-7.75</option>
                                <option value="-7.50">-7.50</option>
                                <option value="-7.25">-7.25</option>
                                <option value="-7.00">-7.00</option>
                                <option value="-6.75">-6.75</option>
                                <option value="-6.50">-6.50</option>
                                <option value="-6.25">-6.25</option>
                                <option value="-6.00">-6.00</option>
                                <option value="-5.75">-5.75</option>
                                <option value="-5.50">-5.50</option>
                                <option value="-5.25">-5.25</option>
                                <option value="-5.00">-5.00</option>
                                <option value="-4.75">-4.75</option>
                                <option value="-4.50">-4.50</option>
                                <option value="-4.25">-4.25</option>
                                <option value="-4.00">-4.00</option>
                                <option value="-3.75">-3.75</option>
                                <option value="-3.50">-3.50</option>
                                <option value="-3.25">-3.25</option>
                                <option value="-3.00">-3.00</option>
                                <option value="-2.75">-2.75</option>
                                <option value="-2.50">-2.50</option>
                                <option value="-2.25">-2.25</option>
                                <option value="-2.00">-2.00</option>
                                <option value="-1.75">-1.75</option>
                                <option value="-1.50">-1.50</option>
                                <option value="-1.25">-1.25</option>
                                <option value="-1.00">-1.00</option>
                                <option value="-0.75">-0.75</option>
                                <option value="-0.50">-0.50</option>
                                <option value="-0.25">-0.25</option>
                                                                <option value="0.50">0.50</option>
                                <option value="0.75">0.75</option>
                                <option value="1.00">1.00</option>
                                <option value="1.25">1.25</option>
                                <option value="1.50">1.50</option>
                                <option value="1.75">1.75</option>
                                <option value="2.00">2.00</option>
                                <option value="2.25">2.25</option>
                                <option value="2.50">2.50</option>
                                <option value="2.75">2.75</option>
                                <option value="3.00">3.00</option>
                                <option value="3.25">3.25</option>
                                <option value="3.50">3.50</option>
                                <option value="3.75">3.75</option>
                                <option value="4.00">4.00</option>
                                <option value="4.25">4.25</option>
                                <option value="4.50">4.50</option>
                                <option value="4.75">4.75</option>
                                <option value="5.00">5.00</option>
                                <option value="5.25">5.25</option>
                                <option value="5.50">5.50</option>
                                <option value="5.75">5.75</option>
                                <option value="6.00">6.00</option>
                                <option value="6.25">6.25</option>
                                <option value="6.50">6.50</option>
                                <option value="6.75">6.75</option>
                                <option value="7.00">7.00</option>
                                <option value="7.25">7.25</option>
                                <option value="7.50">7.50</option>
                                <option value="7.75">7.75</option>
                                <option value="8.00">8.00</option>
                                <option value="8.25">8.25</option>
                                <option value="8.50">8.50</option>
                                <option value="8.75">8.75</option>
                                <option value="9.00">9.00</option>
                                <option value="9.25">9.25</option>
                                <option value="9.50">9.50</option>
                                <option value="9.75">9.75</option>
                                <option value="10.00">10.00</option>
                                <option value="10.25">10.25</option>
                                <option value="10.50">10.50</option>
                                <option value="10.75">10.75</option>
                                <option value="11.00">11.00</option>
                                <option value="11.25">11.25</option>
                                <option value="11.50">11.50</option>
                                <option value="11.75">11.75</option>
                                <option value="12.00">12.00</option>
                                <option value="12.25">12.25</option>
                                <option value="12.50">12.50</option>
                                <option value="12.75">12.75</option>
                                <option value="13.00">13.00</option>
                                <option value="13.25">13.25</option>
                                <option value="13.50">13.50</option>
                                <option value="13.75">13.75</option>
                                <option value="14.00">14.00</option>
                                <option value="14.25">14.25</option>
                                <option value="14.50">14.50</option>
                                <option value="14.75">14.75</option>
                                <option value="15.00">15.00</option>
                                <option value="15.25">15.25</option>
                                <option value="15.50">15.50</option>
                                <option value="15.75">15.75</option>
                                <option value="16.00">16.00</option>
                                <option value="16.25">16.25</option>
                                <option value="16.50">16.50</option>
                                <option value="16.75">16.75</option>
                                <option value="17.00">17.00</option>
                                <option value="17.25">17.25</option>
                                <option value="17.50">17.50</option>
                                <option value="17.75">17.75</option>
                                <option value="18.00">18.00</option>
                                <option value="18.25">18.25</option>
                                <option value="18.50">18.50</option>
                                <option value="18.75">18.75</option>
                                <option value="19.00">19.00</option>
                                <option value="19.25">19.25</option>
                                <option value="19.50">19.50</option>
                                <option value="19.75">19.75</option>
                                <option value="20.00">20.00</option>

                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <select required name="leftLensCylStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="-0.25">-0.25</option>
                                <option value="-0.50">-0.50</option>
                                <option value="-0.75">-0.75</option>
                                <option value="-1.00">-1.00</option>
                                <option value="-1.25">-1.25</option>
                                <option value="-1.50">-1.50</option>
                                <option value="-1.75">-1.75</option>
                                <option value="-2.00">-2.00</option>
                                <option value="-2.25">-2.25</option>
                                <option value="-2.50">-2.50</option>
                                <option value="-2.75">-2.75</option>
                                <option value="-3.00">-3.00</option>
                                <option value="-3.25">-3.25</option>
                                <option value="-3.50">-3.50</option>
                                <option value="-3.75">-3.75</option>
                                <option value="-4.00">-4.00</option>
                                <option value="-4.25">-4.25</option>
                                <option value="-4.50">-4.50</option>
                                <option value="-4.75">-4.75</option>
                                <option value="-5.00">-5.00</option>
                                <option value="-5.25">-5.25</option>
                                <option value="-5.50">-5.50</option>
                                <option value="-5.75">-5.75</option>
                                <option value="-6.00">-6.00</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <select  required name="leftLensAxisStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="15">15</option>
                                <option value="20">20</option>
                                <option value="25">25</option>
                                <option value="30">30</option>
                                <option value="35">35</option>
                                <option value="40">40</option>
                                <option value="45">45</option>
                                <option value="50">50</option>
                                <option value="55">55</option>
                                <option value="60">60</option>
                                <option value="65">65</option>
                                <option value="70">70</option>
                                <option value="75">75</option>
                                <option value="80">80</option>
                                <option value="85">85</option>
                                <option value="90">90</option>
                                <option value="95">95</option>
                                <option value="100">100</option>
                                <option value="105">105</option>
                                <option value="110">110</option>
                                <option value="115">115</option>
                                <option value="120">120</option>
                                <option value="125">125</option>
                                <option value="130">130</option>
                                <option value="135">135</option>
                                <option value="140">140</option>
                                <option value="145">145</option>
                                <option value="150">150</option>
                                <option value="155">155</option>
                                <option value="160">160</option>
                                <option value="165">165</option>
                                <option value="170">170</option>
                                <option value="175">175</option>
                                <option value="180">180</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <select required name="leftLensAddStock[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select</option>
                                <!-- Add options dynamically -->
                                <option value="+1.00">+1.00</option>
                                <option value="+1.25">+1.25</option>
                                <option value="+1.50">+1.50</option>
                                <option value="+1.75">+1.75</option>
                                <option value="+2.00">+2.00</option>
                                <option value="+.2.25">+.2.25</option>
                                <option value="+2.50">+2.50</option>
                                <option value="+2.75">+2.75</option>
                                <option value="+3.00">+3.00</option>
                                <option value="+3.50">+3.50</option>
                                <option value="+4.00">+4.00</option>
                            </select>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                        <input required name="leftLensPdStock[${productCardCount}]" class="form-control" aria-label="Default select example"
                        placeholder = "PD value"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>

                            <div class="invalid-feedback">This field is required.

                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row mb-3 rx_power_card[${productCardCount}]" id="rx_power_card[${productCardCount}]" style="display:none">
        <div class="col-12">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">EYE</th>
                        <th scope="col">SPH</th>
                        <th scope="col">CYL</th>
                        <th scope="col">AXIS</th>
                        <th scope="col">ADD</th>
                        <th scope="col">PD</th>
                    </tr>
                </thead>
                <tbody class="rx_power_card_table[${productCardCount}]" id="rx_power_card_table[${productCardCount}]">
                    <tr>
                        <th scope="row">Right</th>
                        <td class="col-auto col-lg-2">
                            <input required name="rightLensSphRx[${productCardCount}]" class="form-control" aria-label="Default select example"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <input required name="rightLensCylRx[${productCardCount}]" class="form-control" aria-label="Default select example"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <input required name="rightLensAxisRx[${productCardCount}]" class="form-control" aria-label="Default select example"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <input required name="rightLensAddRx[${productCardCount}]" class="form-control" aria-label="Default select example"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <input required name="rightLensPdRx[${productCardCount}]" class="form-control" aria-label="Default select example"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                    </tr>
                     <tr>
                        <th scope="row">Left</th>
                        <td class="col-6 col-lg-2">
                            <input required name="leftLensSphRx[${productCardCount}]" class="form-control" aria-label="Default select example"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <input required name="leftLensCylRx[${productCardCount}]" class="form-control" aria-label="Default select example"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <input required name="leftLensAxisRx[${productCardCount}]" class="form-control" aria-label="Default select example"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <input required name="leftLensAddRx[${productCardCount}]" class="form-control" aria-label="Default select example"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>
                                                                    <div class="invalid-feedback">This field is required.

                        </td>
                        <td class="col-auto col-lg-2">
                            <input required name="leftLensPdRx[${productCardCount}]" class="form-control" aria-label="Default select example"
                            oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"/>
                                                                    <div class="invalid-feedback">This field is required.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>`;

    document.querySelector("#products_container").appendChild(lensProductCard);

    let choicesInstance = new Choices(lensProductCard.querySelector("[name='product']"), {
        // Pass any necessary options for Choices.js
        removeItemButton: true,
        placeholder: true,
    });

    productCardCount++;

}


function addStockContactLensContainer() {
    let contactLensProductCard = document.createElement("div");
    contactLensProductCard.classList.add("product_widget", "card-header", "bg-100", "mb-4");
    contactLensProductCard.innerHTML = `

    <div class="col text-end">
        <a onclick="removeProductCard(this)" type="button" class="text-danger">
            Remove <i class="fas fa-trash"></i>
        </a>
    </div>

    <div class="mb-3 col-12">
        <h6 class="mb-3">Select Contact Lens</h6>
        <select onchange="updateContactLensProductFields(this, ${productCardCount})" class="form-select" data-choices="data-choices"
                data-options='{"removeItemButton":true,"placeholder":true}'
                name="product" required="required">
            <option value="">Select Contact Lens</option>
            {% for product in contact_lens_list %}
            {% if product.category_id == 3 %}
            <option value="{{product.product_id}}">
                {{product.product_name}}
            </option>
            {% endif %}
            {% endfor %}
        </select>
        <div class="custom-error" style="color: red;"></div>
    </div>
    <div class="row g-3 mb-3">
        <div class="mb2 col-4">
            <h6 class="mb-3">Vision Type</h6>
            <input class="form-control"
                   name="lens_type[${productCardCount}]"
                   placeholder="Stock/Rx"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>

        <input class="form-control"
                   name="product_category_id[${productCardCount}]"
                   placeholder="Category"
                   required="required"
                   hidden

                   type="text" value="" readonly/>
        <input class="form-control"
                   name="product_name[${productCardCount}]"
                   placeholder="Name"
                   required="required"
                   hidden
                   type="text" value="" readonly/>

        <div class="mb2 col-4">
            <h6 class="mb-3">Contact Lens Type</h6>
            <input class="form-control"
                   name="lens_physicality[${productCardCount}]"
                   placeholder="Physicality"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Contact Lens Disposablility</h6>
            <input class="form-control"
                   name="lens_disposablility[${productCardCount}]"
                   placeholder="Disposablility"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
<!--        <div class="mb2 col-4">-->
<!--            <h6 class="mb-3">Vision Type</h6>-->
<!--            <input class="form-control"-->
<!--                   name="vision_type[${productCardCount}]"-->
<!--                   placeholder="Vision Type"-->
<!--                   required="required"-->
<!--                   type="text" value="" readonly/>-->
<!--            <div class="invalid-feedback">This field is required.-->
<!--            </div>-->
<!--        </div>-->
        <div class="mb2 col-4">
            <h6 class="mb-3">Product Brand</h6>
            <input class="form-control"
                   name="product_brand[${productCardCount}]"
                   placeholder="Brand"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <!-- Add the rest of your product card HTML structure here -->
        <div class="mb2 col-4">
            <h6 class="mb-3">Product HSN</h6>
            <input class="form-control"
                   name="product_hsn[${productCardCount}]"
                   placeholder="HSN"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Available Quantity</h6>
            <input class="form-control"
                   name="available_qty[${productCardCount}]"
                   placeholder="Available Quantity"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Unit Price(₹)</h6>
            <input class="form-control"
                   name="unit_price[${productCardCount}]"
                   placeholder="Unit Price"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Unit Type</h6>
            <input class="form-control"
                   name="unit_type[${productCardCount}]"
                   placeholder="Unit Type"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6">
            <h6 class="mb-3">Purchase Quantity</h6>
            <input class="form-control"
                   name="purchase_qty[${productCardCount}]"
                   placeholder="Purchase quantity"
                   required="required"
                   min="1"
                   type="number" value=""/>
            <div class="invalid-feedback">This field should be 1 in
                minimum and should be less than available quantity.
            </div>
        </div>
        <div class="mb2 col-6">
            <h6 class="mb-3">Product Total</h6>
            <input class="form-control"
                   name="product_total[${productCardCount}]"
                   placeholder="Product Total"
                   required="required"
                   type="text" value="0" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6" id="discount_check_div[${productCardCount}]">
            <input id="discount_value_field[${productCardCount}]"
                   type="hidden"
                   class="form-check"
                   name="discount_percentage[${productCardCount}]"
                   required="required" readonly/>
            <input class="form-check-input" type="checkbox"
                   name="discount_checked[${productCardCount}]"
                   id="bootstrap-wizard-validation-wizard-checkbox_cl" value="off"/>
            <label id="discount_value[${productCardCount}]"
                   class="form-check-label text-900"
                   for="bootstrap-wizard-validation-wizard-checkbox"></label>
        </div>
    </div>
    <div class="dropdown-divider"></div>
    <h6 class="mb-3">Power attributes</h6>

    <div class="row mb-3 cl_rx_power_card" id="cl_rx_power_card[${productCardCount}]">
        <div class="col-12">
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">Power</th>
                    <th scope="col">BC</th>
                    <th scope="col">DIA</th>
                    <th scope="col">CYLINDER</th>
                    <th scope="col">AXIS</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="col-auto col-lg-2">
                        <input readonly name="cl_power[${productCardCount}]"
                               class="form-control"
                               oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"
                               aria-label="Default select example"/>
                    </td>
                    <td class="col-auto col-lg-2">
                        <input readonly name="cl_bc[${productCardCount}]"
                               class="form-control"
                               oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"
                               aria-label="Default select example">
                    </td>
                    <td class="col-auto col-lg-2">
                        <input readonly name="cl_dia[${productCardCount}]"
                               class="form-control"
                               oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"
                               aria-label="Default select example"/>
                    </td>
                    <td class="col-auto col-lg-2">
                        <input readonly name="cl_cylinder[${productCardCount}]"
                               class="form-control"
                               oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"
                               aria-label="Default select example"/>
                    </td>
                    <td class="col-auto col-lg-2">
                        <input readonly name="cl_axis[${productCardCount}]"
                        oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"
                               class="form-control"
                               aria-label="Default select example"/>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    `;

    document.querySelector("#products_container").appendChild(contactLensProductCard);
    let choicesInstance = new Choices(contactLensProductCard.querySelector("[name='product']"), {
        // Pass any necessary options for Choices.js
        removeItemButton: true,
        placeholder: true,
    });

    productCardCount++;

}



function addRxContactLensContainer() {
    let contactLensProductCard = document.createElement("div");
    contactLensProductCard.classList.add("product_widget", "card-header", "bg-100", "mb-4");
    contactLensProductCard.innerHTML = `

    <div class="col text-end">
        <a onclick="removeProductCard(this)" type="button" class="text-danger">
            Remove <i class="fas fa-trash"></i>
        </a>
    </div>

    <div class="mb-3 col-12">
        <h6 class="mb-3">Select Contact Lens</h6>
        <select onchange="updateRxContactLensProductFields(this, ${productCardCount})" class="form-select" data-choices="data-choices"
                data-options='{"removeItemButton":true,"placeholder":true}'
                name="product" required="required">
            <option value="">Select Contact Lens</option>
            {% for product in contact_lens_list %}
            {% if product.category_id == 3 %}
            <option value="{{product.product_id}}">
                {{product.product_name}}
            </option>
            {% endif %}
            {% endfor %}
        </select>
        <div class="custom-error" style="color: red;"></div>
    </div>
    <div class="row g-3 mb-3">
        <div class="mb2 col-4">
            <h6 class="mb-3">Type</h6>
            <input class="form-control"
                   name="ContactLensStockType[${productCardCount}]"
                   placeholder="Stock/Rx"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>

        <input class="form-control"
                   name="product_category_id[${productCardCount}]"
                   placeholder="Category"
                   required="required"
                   hidden

                   type="text" value="" readonly/>
        <input class="form-control"
                   name="product_category[${productCardCount}]"
                   placeholder="Category"
                   required="required"
                   hidden

                   type="text" value="" readonly/>
        <input class="form-control"
                   name="product_name[${productCardCount}]"
                   placeholder="Name"
                   required="required"
                   hidden
                   type="text" value="" readonly/>
        <div class="mb2 col-4">
            <h6 class="mb-3">Contact Lens Type</h6>
            <input class="form-control"
                   name="lens_physicality[${productCardCount}]"
                   placeholder="Physicality"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Contact Lens Disposablility</h6>
            <input class="form-control"
                   name="lens_disposablility[${productCardCount}]"
                   placeholder="Disposablility"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
<!--        <div class="mb2 col-4">-->
<!--            <h6 class="mb-3">Vision Type</h6>-->
<!--            <input class="form-control"-->
<!--                   name="vision_type[${productCardCount}]"-->
<!--                   placeholder="Vision Type"-->
<!--                   required="required"-->
<!--                   type="text" value="" readonly/>-->
<!--            <div class="invalid-feedback">This field is required.-->
<!--            </div>-->
<!--        </div>-->
        <div class="mb2 col-4">
            <h6 class="mb-3">Product Brand</h6>
            <input class="form-control"
                   name="product_brand[${productCardCount}]"
                   placeholder="Brand"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <!-- Add the rest of your product card HTML structure here -->
        <div class="mb2 col-4">
            <h6 class="mb-3">Product HSN</h6>
            <input class="form-control"
                   name="product_hsn[${productCardCount}]"
                   placeholder="HSN"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Available Quantity</h6>
            <input class="form-control"
                   name="available_qty[${productCardCount}]"
                   placeholder="Available Quantity"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Unit Price(₹)</h6>
            <input class="form-control"
                   name="unit_price[${productCardCount}]"
                   placeholder="Unit Price"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Unit Type</h6>
            <input class="form-control"
                   name="unit_type[${productCardCount}]"
                   placeholder="Unit Type"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6">
            <h6 class="mb-3">Purchase Quantity</h6>
            <input class="form-control"
                   name="purchase_qty[${productCardCount}]"
                   placeholder="Purchase quantity"
                   required="required"
                   min="1"
                   type="number" value=""/>
            <div class="invalid-feedback">This field should be 1 in
                minimum and should be less than available quantity.
            </div>
        </div>
        <div class="mb2 col-6">
            <h6 class="mb-3">Product Total</h6>
            <input class="form-control"
                   name="product_total[${productCardCount}]"
                   placeholder="Product Total"
                   required="required"
                   type="text" value="0" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6" id="discount_check_div[${productCardCount}]">
            <input id="discount_value_field[${productCardCount}]"
                   type="hidden"
                   class="form-check"
                   name="discount_percentage[${productCardCount}]"
                   required="required" readonly/>
            <input class="form-check-input" type="checkbox"
                   name="discount_checked[${productCardCount}]"
                   id="bootstrap-wizard-validation-wizard-checkbox_cl" value="off"/>
            <label id="discount_value[${productCardCount}]"
                   class="form-check-label text-900"
                   for="bootstrap-wizard-validation-wizard-checkbox"></label>
        </div>
    </div>
    <div class="dropdown-divider"></div>
    <h6 class="mb-3">Power attributes</h6>

    <div class="row mb-3 cl_rx_power_card" id="cl_rx_power_card[${productCardCount}]">
        <div class="col-12">
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">Eye</th>
                    <th scope="col">Power</th>
                    <th scope="col">BC</th>
                    <th scope="col">DIA</th>
                    <th scope="col">CYLINDER</th>
                    <th scope="col">AXIS</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="col-auto col-lg-2">
                            <select required name="cl_eye[${productCardCount}]" class="form-select" aria-label="Default select example">
                                <option value="">Select Eye</option>
                                <option value="Right">Right</option>
                                <option value="Left">Left</option>
                                <option value="Both">Both</option>
                            </select>
                                        <div class="invalid-feedback">This field is required.

                        </td>
                    <td class="col-auto col-lg-2">
                        <input name="cl_power[${productCardCount}]"
                               class="form-control"
                               required="required"
                               oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"
                               aria-label="Default select example"/>
                                           <div class="invalid-feedback">This field is required.

                    </td>
                    <td class="col-auto col-lg-2">
                        <input name="cl_bc[${productCardCount}]"
                               class="form-control"
                               required="required"
                               oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"
                               aria-label="Default select example">
                                           <div class="invalid-feedback">This field is required.

                    </td>
                    <td class="col-auto col-lg-2">
                        <input name="cl_dia[${productCardCount}]"
                               class="form-control"
                               required="required"
                               oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"
                               aria-label="Default select example"/>
                                           <div class="invalid-feedback">This field is required.

                    </td>
                    <td class="col-auto col-lg-2">
                        <input name="cl_cylinder[${productCardCount}]"
                               class="form-control"
                               required="required"
                               oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"
                               aria-label="Default select example"/>
                                           <div class="invalid-feedback">This field is required.

                    </td>
                    <td class="col-auto col-lg-2">
                        <input name="cl_axis[${productCardCount}]"
                        required="required"
                               class="form-control"
                               oninput="event.target.value = event.target.value.replace(/[^-0-9.]/g, '');"
                               aria-label="Default select example"/>
                                           <div class="invalid-feedback">This field is required.

                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    `;

    document.querySelector("#products_container").appendChild(contactLensProductCard);
    let choicesInstance = new Choices(contactLensProductCard.querySelector("[name='product']"), {
        // Pass any necessary options for Choices.js
        removeItemButton: true,
        placeholder: true,
    });

    productCardCount++;

}


function addOtherProductsContainer() {
    let contactLensProductCard = document.createElement("div");
    contactLensProductCard.classList.add("product_widget", "card-header", "bg-100", "mb-4");
    contactLensProductCard.innerHTML = `
    <div class="col text-end">
        <a onclick="removeProductCard(this)" type="button" class="text-danger">
            Remove <i class="fas fa-trash"></i>
        </a>
    </div>

    <div class="mb-3 col-12">
        <h6 class="mb-3">Select Product</h6>
        <select onchange="updateOtherProductFields(this, ${productCardCount})" class="form-select" data-choices="data-choices"
                data-options='{"removeItemButton":true,"placeholder":true}'
                name="product" required="required">
            <option value="">Select Product</option>
            {% for product in other_products_list %}
            <option value="{{product.product_id}}">
                {{product.product_name}}
            </option>
            {% endfor %}
        </select>
        <div class="custom-error" style="color: red;"></div>
    </div>
    <div class="row g-3 mb-3">
        <div class="mb2 col-4">
            <h6 class="mb-3">Product Category</h6>
            <input class="form-control"
                   name="product_category[${productCardCount}]"
                   placeholder="Category"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <input class="form-control"
                   name="product_category_id[${productCardCount}]"
                   placeholder="Category"
                   hidden
                   required="required"
                   type="text" value="" readonly/>
        <input class="form-control"
                   name="product_name[${productCardCount}]"
                   placeholder="Name"
                   required="required"
                   hidden
                   type="text" value="" readonly/>
        <div class="mb2 col-4">
            <h6 class="mb-3">Product Brand</h6>
            <input class="form-control"
                   name="product_brand[${productCardCount}]"
                   placeholder="Brand"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <!-- Add the rest of your product card HTML structure here -->
        <div class="mb2 col-4">
            <h6 class="mb-3">Product HSN</h6>
            <input class="form-control"
                   name="product_hsn[${productCardCount}]"
                   placeholder="HSN"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Available Quantity</h6>
            <input class="form-control"
                   name="available_qty[${productCardCount}]"
                   placeholder="Available Quantity"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Unit Price(₹)</h6>
            <input class="form-control"
                   name="unit_price[${productCardCount}]"
                   placeholder="Unit Price"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-4">
            <h6 class="mb-3">Unit Type</h6>
            <input class="form-control"
                   name="unit_type[${productCardCount}]"
                   placeholder="Unit Type"
                   required="required"
                   type="text" value="" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6">
            <h6 class="mb-3">Purchase Quantity</h6>
            <input class="form-control"
                   name="purchase_qty[${productCardCount}]"
                   placeholder="Purchase quantity"
                   required="required"
                   min="1"
                   type="number" value=""/>
            <div class="invalid-feedback">This field should be 1 in
                minimum and should be less than available quantity.
            </div>
        </div>
        <div class="mb2 col-6">
            <h6 class="mb-3">Product Total</h6>
            <input class="form-control"
                   name="product_total[${productCardCount}]"
                   placeholder="Product Total"
                   required="required"
                   type="text" value="0" readonly/>
            <div class="invalid-feedback">This field is required.
            </div>
        </div>
        <div class="mb2 col-6" id="discount_check_div[${productCardCount}]">
            <input id="discount_value_field[${productCardCount}]"
                   type="hidden"
                   class="form-check"
                   name="discount_percentage[${productCardCount}]"
                   required="required" readonly/>
            <input class="form-check-input" type="checkbox"
                   name="discount_checked[${productCardCount}]"
                   id="bootstrap-wizard-validation-wizard-checkbox_cl" value="off"/>
            <label id="discount_value[${productCardCount}]"
                   class="form-check-label text-900"
                   for="discount_value_field[${productCardCount}]"></label>
        </div>
    </div>`;

    document.querySelector("#products_container").appendChild(contactLensProductCard);
    let choicesInstance = new Choices(contactLensProductCard.querySelector("[name='product']"), {
        // Pass any necessary options for Choices.js
        removeItemButton: true,
        placeholder: true,
    });

    productCardCount++;

}

function removeProductCard(removeButton) {
    // Find the parent product card and remove it
    let productCard = removeButton.closest(".product_widget");
    if (productCard) {
        productCard.remove();
        getProductsData();
    }
}



</script>
<script>
function updateCustomerFields(selectCustomerField) {
    var customers_list = JSON.parse(document.getElementById('customersList').textContent);
    let selectCustomer = customers_list.find(customer => customer.phone == selectCustomerField.value);

    var customerNameInput = document.getElementsByName("customer_name")[0];
    var customerEmailInput = document.getElementsByName("customer_email")[0];
    var customerPhoneInput = document.getElementsByName("customer_phone")[0];
    var customerAgeInput = document.getElementsByName("customer_age")[0];
    var customerGenderSelect = document.getElementsByName("customer_gender")[0];
    var customerCityInput = document.getElementsByName("customer_city")[0];
    var customerLanguageSelect = document.getElementsByName("customer_language")[0];
    var customerAddressTextarea = document.getElementsByName("customer_address")[0];
    //customerDataField
    var customerDataTextarea = document.getElementsByName("customerData")[0];

    if(selectCustomer){
    customerNameInput.value = selectCustomer.name;
    customerEmailInput.value = selectCustomer.email;
    customerPhoneInput.value = selectCustomer.phone;
    customerAgeInput.value = selectCustomer.age;
    customerGenderSelect.value = selectCustomer.gender;
    customerCityInput.value = selectCustomer.city;
    customerLanguageSelect.value = selectCustomer.language;
    customerAddressTextarea.value = selectCustomer.address;
    customerDataTextarea.value = selectCustomer.address;

    var customerdata = {
        name: selectCustomer.name,
        email: selectCustomer.email,
        phone: selectCustomer.phone,
        age: selectCustomer.age,
        gender: selectCustomer.gender,
        city: selectCustomer.city,
        language: selectCustomer.language,
        address: selectCustomer.address
    };

    // Convert customerdata to JSON string and assign it to customerDataTextarea
    customerDataTextarea.value = JSON.stringify(customerdata, null, 2);
    }else{
    customerNameInput.value = '';
    customerEmailInput.value = '';
    customerPhoneInput.value = '';
    customerAgeInput.value = '';
    customerGenderSelect.value = '';
    customerCityInput.value = '';
    customerLanguageSelect.value = '';
    customerAddressTextarea.value = '';
    customerDataTextarea.value ='';

    var customerdata = {

    };

    // Convert customerdata to JSON string and assign it to customerDataTextarea
    customerDataTextarea.value = JSON.stringify(customerdata, null, 2);
    }

}

function genCustomerObject() {
    var customerNameInput = document.getElementsByName("customer_name")[0];
    var customerEmailInput = document.getElementsByName("customer_email")[0];
    var customerPhoneInput = document.getElementsByName("customer_phone")[0];
    var customerAgeInput = document.getElementsByName("customer_age")[0];
    var customerGenderSelect = document.getElementsByName("customer_gender")[0];
    var customerCityInput = document.getElementsByName("customer_city")[0];
    var customerLanguageSelect = document.getElementsByName("customer_language")[0];
    var customerAddressTextarea = document.getElementsByName("customer_address")[0];
    //customerDataField
    var customerDataTextarea = document.getElementsByName("customerData")[0];

    var customerData = {
        name: customerNameInput.value,
        email: customerEmailInput.value,
        phone: customerPhoneInput.value,
        age: customerAgeInput.value,
        gender: customerGenderSelect.value,
        city: customerCityInput.value,
        language: customerLanguageSelect.value,
        address: customerAddressTextarea.value
    };
    customerDataTextarea.value = JSON.stringify(customerData, null, 2);
}

function genBillingInfoObject() {
    var estDeliveryDateInput = document.getElementsByName("estDeliveryDate")[0];
    var assignedLabInput = document.getElementsByName("assignedLab")[0];
    var orderByEmployeeInput = document.getElementsByName("orderByEmployee")[0];
    var billingDetailsDataTextarea = document.getElementsByName("billingDetailsData")[0];
    var amountPaidInput = document.getElementsByName("amount_paid")[0];
    var saleNoteInput = document.getElementsByName("sale_note")[0];
    var paymentModeInput = document.getElementsByName("payment_mode")[0];

    var amountPaid = parseFloat(amountPaidInput.value);

    if(amountPaid>0){
    paymentModeInput.disabled = false;
    }else{
    paymentModeInput.value = "";
    paymentModeInput.disabled = true;
    }

    var billingInfoData = {
        estDeliveryDate: estDeliveryDateInput.value,
        assignedLab: assignedLabInput.value,
        orderByEmployee: orderByEmployeeInput.value,
        amount_paid: amountPaidInput.value,
        orderId: "ORDER" + generateRandomId(),
        saleNote: saleNoteInput.value,
        paymentMode:paymentModeInput.value
    };
    billingDetailsDataTextarea.value = JSON.stringify(billingInfoData, null, 2);
}

function generateRandomId() {
    const epochTime = new Date().getTime(); // Get current epoch time
    const randomNum = Math.floor(Math.random() * 10000); // Generate a random number
    const randomId = `${epochTime}${randomNum}`;
    return randomId;
}
document.getElementById('confirmSale').addEventListener('click', function () {
    // Assuming you have input fields within the form, adjust as needed
    var form = document.getElementById('saleForm');
    const overlay = document.createElement('div');
    overlay.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background-color: rgba(0, 0, 0, 0.4);
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        z-index: 1000; /* Adjust the z-index as needed */
                    `;
    overlay.innerHTML = `
                         <div style="text-align: center; color: white;">
                            <div style="border: 8px solid #f3f3f3; border-top: 8px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;"></div>
                            <p>Loading...</p>
                        </div>
                    `;

    // Append overlay to the body
    document.body.appendChild(overlay);

    // Simulate loading delay (you can replace this with actual loading logic)
    form.submit();
});


</script>

<script>


function updateLensProductFields(selectElement, cardIndex) {
    let selectedProduct = lens_list.find(product => product.product_id == selectElement.value);
    let productUnitTypeField = document.querySelector(`[name='unit_type[${cardIndex}]']`);
    let productCategoryIdField = document.querySelector(`[name='product_category_id[${cardIndex}]']`);
    let productNameField = document.querySelector(`[name='product_name[${cardIndex}]']`);
    let stockTypeField = document.querySelector(`[name='stock_type[${cardIndex}]']`);
    let productLensTypeField = document.querySelector(`[name='lens_type[${cardIndex}]']`);
    let productBrandField = document.querySelector(`[name='product_brand[${cardIndex}]']`);
    let productHsnField = document.querySelector(`[name='product_hsn[${cardIndex}]']`);
    let productAvailableQtyField = document.querySelector(`[name='available_qty[${cardIndex}]']`);
    let productUnitPriceField = document.querySelector(`[name='unit_price[${cardIndex}]']`);
    let productPurchaseQtyField = document.querySelector(`[name='purchase_qty[${cardIndex}]']`);
    let productProductTotalField = document.querySelector(`[name='product_total[${cardIndex}]']`);
    let productDiscountCheckedField = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
    let discountCheckDiv = document.getElementById('discount_check_div[' + cardIndex + ']');
    let discountValueText = document.getElementById('discount_value[' + cardIndex + ']');
    let discountValueField = document.getElementById('discount_value_field[' + cardIndex + ']');
    let discountCheckbox = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
    let productCategoryField = document.querySelector(`[name='product_category[${cardIndex}]']`);
    let lensIndexField = document.querySelector(`[name='lens_index[${cardIndex}]']`);

    let stockPowerCard = document.getElementById('stock_power_card[' + cardIndex + ']');
    let rxPowerCard = document.getElementById('rx_power_card[' + cardIndex + ']');

    productBrandField.value = selectedProduct?.brand_name ?? '';
    productLensTypeField.value = selectedProduct?.power_attribute.vision_type ?? '';
    productHsnField.value = selectedProduct?.hsn ?? '';
    productAvailableQtyField.value = selectedProduct?.product_quantity ?? '';
    productUnitPriceField.value = selectedProduct?.sale_price ?? '';
    productUnitPriceField.value = selectedProduct?.sale_price ?? '';
    productUnitTypeField.value = selectedProduct?.unit_name ?? '';
    stockTypeField.value = selectedProduct?.power_attribute.stock_type ?? '';
    productCategoryIdField.value = selectedProduct?.category_id ?? '';
    productNameField.value = selectedProduct?.product_name ?? '';
    productCategoryField.value = selectedProduct?.category_name ?? '';
    productPurchaseQtyField.value = '';
    lensIndexField.value = selectedProduct.power_attribute.index;
    productPurchaseQtyField.max = selectedProduct?.product_quantity;

    if (selectedProduct.discount > 0) {
        discountCheckDiv.style.display = 'block';
        discountValueText.innerHTML = '<h6>Discount available !</h6> Apply discount : ' + selectedProduct.discount + '%';
        discountValueField.value = selectedProduct.discount;
    } else {
        discountCheckDiv.style.display = 'none';
    }
    if (selectedProduct.power_attribute.stock_type == 'stock') {
        stockPowerCard.style.display = 'block';
        rxPowerCard.style.display = 'none';
        // Remove 'required' attribute from all inputs and selects in rxPowerCard
        let rxPowerCardInputs = rxPowerCard.querySelectorAll('input, select');
        let stockPowerCardInputs = stockPowerCard.querySelectorAll('input, select');

<!--        rxPowerCardInputs.forEach(input => {-->
<!--            input.removeAttribute('required');-->
<!--        });-->
<!--        stockPowerCardInputs.forEach(input => {-->
<!--            input.setAttribute('required', 'required');-->
<!--        });-->
    } else {
        rxPowerCard.style.display = 'block';
        stockPowerCard.style.display = 'none';
        // Add 'required' attribute to inputs and selects in rxPowerCard
        let rxPowerCardInputs = rxPowerCard.querySelectorAll('input, select');
        let stockPowerCardInputs = stockPowerCard.querySelectorAll('input, select');

<!--        stockPowerCardInputs.forEach(input => {-->
<!--            input.removeAttribute('required');-->
<!--        });-->
<!--        rxPowerCardInputs.forEach(input => {-->
<!--            input.setAttribute('required', 'required');-->
<!--        });-->
    }

    productPurchaseQtyField.addEventListener('input', function () {
        let purchaseQty = parseFloat(productPurchaseQtyField.value) || 0;
        let productTotal;
        if (discountCheckbox.checked) {
            // Apply discount if the checkbox is checked
            let discountPercentage = parseFloat(discountValueField.value) || 0;
            let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
            productTotal = purchaseQty * discountedPrice;
        } else {
            // No discount, use the original sale price
            productTotal = purchaseQty * parseFloat(selectedProduct.sale_price) || 0;
        }
        productProductTotalField.value = productTotal.toFixed(2);
    });

    discountCheckbox.addEventListener('change', function () {
        let isChecked = discountCheckbox.checked;
        if (isChecked) {
            let discountPercentage = parseFloat(discountValueField.value) || 0;
            let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
            productProductTotalField.value = (discountedPrice * productPurchaseQtyField.value).toFixed(2);
            discountCheckbox.value = 'on';
        } else {
            productProductTotalField.value = (selectedProduct.sale_price * productPurchaseQtyField.value).toFixed(2);
            productProductTotalField.innerHTML = '';
            discountCheckbox.value = 'off';
        }
    });
}

function updateContactLensProductFields(selectElement, cardIndex) {
    let selectedProduct = contact_lens_list.find(product => product.product_id == selectElement.value);
    let lensTypeField = document.querySelector(`[name='lens_type[${cardIndex}]']`);
    let lensPhysicalityField = document.querySelector(`[name='lens_physicality[${cardIndex}]']`);
    let lensDisposablilityField = document.querySelector(`[name='lens_disposablility[${cardIndex}]']`);
    let lensVisionTypeField = document.querySelector(`[name='vision_type[${cardIndex}]']`);
    let productBrandField = document.querySelector(`[name='product_brand[${cardIndex}]']`);
    let productHsnField = document.querySelector(`[name='product_hsn[${cardIndex}]']`);
    let productAvailableQtyField = document.querySelector(`[name='available_qty[${cardIndex}]']`);
    let productUnitPriceField = document.querySelector(`[name='unit_price[${cardIndex}]']`);
    let productPurchaseQtyField = document.querySelector(`[name='purchase_qty[${cardIndex}]']`);
    let productProductTotalField = document.querySelector(`[name='product_total[${cardIndex}]']`);
    let productDiscountCheckedField = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
    let discountCheckDiv = document.getElementById('discount_check_div[' + cardIndex + ']');
    let discountValueText = document.getElementById('discount_value[' + cardIndex + ']');
    let discountValueField = document.getElementById('discount_value_field[' + cardIndex + ']');
    let discountCheckbox = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
    let productUnitTypeField = document.querySelector(`[name='unit_type[${cardIndex}]']`);
    let clPowerField = document.querySelector(`[name='cl_power[${cardIndex}]']`);
    let clBcField = document.querySelector(`[name='cl_bc[${cardIndex}]']`);
    let clDiaField = document.querySelector(`[name='cl_dia[${cardIndex}]']`);
    let clCylField = document.querySelector(`[name='cl_cylinder[${cardIndex}]']`);
    let clAxisField = document.querySelector(`[name='cl_axis[${cardIndex}]']`);
    let productCategoryIdField = document.querySelector(`[name='product_category_id[${cardIndex}]']`);
    let productNameField = document.querySelector(`[name='product_name[${cardIndex}]']`);
    let productCategoryField = document.querySelector(`[name='product_category[${cardIndex}]']`);

    lensTypeField.value = selectedProduct?.power_attribute.stock_type ?? '';
    lensPhysicalityField.value = selectedProduct?.power_attribute.contact_lens_type ?? '';
    lensDisposablilityField.value = selectedProduct?.power_attribute.contact_lens_disposability ?? '';
    productHsnField.value = selectedProduct?.hsn ?? '';
    productAvailableQtyField.value = selectedProduct?.store_product_quantity ?? '';
    productBrandField.value = selectedProduct?.brand_name ?? '';
    productUnitPriceField.value = selectedProduct?.sale_price ?? '';
    productUnitTypeField.value = selectedProduct?.unit_name ?? '';
    productCategoryIdField.value = selectedProduct?.category_id ?? '';
    productNameField.value = selectedProduct?.product_name ?? '';
    productCategoryField.value = selectedProduct?.category_name ?? '';
    productPurchaseQtyField.value = '';
    productPurchaseQtyField.max = selectedProduct?.store_product_quantity;

    clPowerField.value = selectedProduct?.power_attribute.power ?? '';
    clBcField.value = selectedProduct?.power_attribute.bc ?? '';
    clDiaField.value = selectedProduct?.power_attribute.dia ?? '';
    clCylField.value = selectedProduct?.power_attribute.cyl ?? '';
    clAxisField.value = selectedProduct?.power_attribute.axis ?? '';

    if (selectedProduct.discount > 0) {
        discountCheckDiv.style.display = 'block';
        discountValueText.innerHTML = '<h6>Discount available !</h6> Apply discount : ' + selectedProduct.discount + '%';
        discountValueField.value = selectedProduct.discount;
    } else {
        discountCheckDiv.style.display = 'none';
    }

    productPurchaseQtyField.addEventListener('input', function () {
        let purchaseQty = parseFloat(productPurchaseQtyField.value) || 0;
        let productTotal;
        if (discountCheckbox.checked) {
            // Apply discount if the checkbox is checked
            let discountPercentage = parseFloat(discountValueField.value) || 0;
            let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
            productTotal = purchaseQty * discountedPrice;
        } else {
            // No discount, use the original sale price
            productTotal = purchaseQty * parseFloat(selectedProduct.sale_price) || 0;
        }
        productProductTotalField.value = productTotal.toFixed(2);
    });

    discountCheckbox.addEventListener('change', function () {
        let isChecked = discountCheckbox.checked;
        if (isChecked) {
            let discountPercentage = parseFloat(discountValueField.value) || 0;
            let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
            productProductTotalField.value = (discountedPrice * productPurchaseQtyField.value).toFixed(2);
            discountCheckbox.value = 'on';
        } else {
            productProductTotalField.value = (selectedProduct.sale_price * productPurchaseQtyField.value).toFixed(2);
            productProductTotalField.innerHTML = '';
            discountCheckbox.value = 'off';
        }
    });
}


function updateRxContactLensProductFields(selectElement, cardIndex) {
    let selectedProduct = contact_lens_list.find(product => product.product_id == selectElement.value);
    let stockTypeField = document.querySelector(`[name='ContactLensStockType[${cardIndex}]']`);
    let lensPhysicalityField = document.querySelector(`[name='lens_physicality[${cardIndex}]']`);
    let lensDisposablilityField = document.querySelector(`[name='lens_disposablility[${cardIndex}]']`);
    let lensVisionTypeField = document.querySelector(`[name='vision_type[${cardIndex}]']`);
    let productBrandField = document.querySelector(`[name='product_brand[${cardIndex}]']`);
    let productHsnField = document.querySelector(`[name='product_hsn[${cardIndex}]']`);
    let productAvailableQtyField = document.querySelector(`[name='available_qty[${cardIndex}]']`);
    let productUnitPriceField = document.querySelector(`[name='unit_price[${cardIndex}]']`);
    let productPurchaseQtyField = document.querySelector(`[name='purchase_qty[${cardIndex}]']`); let productProductTotalField = document.querySelector(`[name='product_total[${cardIndex}]']`);
    let productDiscountCheckedField = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
    let discountCheckDiv = document.getElementById('discount_check_div[' + cardIndex + ']');
    let discountValueText = document.getElementById('discount_value[' + cardIndex + ']');
    let discountValueField = document.getElementById('discount_value_field[' + cardIndex + ']');
    let discountCheckbox = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
    let productUnitTypeField = document.querySelector(`[name='unit_type[${cardIndex}]']`);
    let clPowerField = document.querySelector(`[name='cl_power[${cardIndex}]']`);
    let clBcField = document.querySelector(`[name='cl_bc[${cardIndex}]']`);
    let clDiaField = document.querySelector(`[name='cl_dia[${cardIndex}]']`);
    let clCylField = document.querySelector(`[name='cl_cylinder[${cardIndex}]']`);
    let clAxisField = document.querySelector(`[name='cl_axis[${cardIndex}]']`);
    let productCategoryIdField = document.querySelector(`[name='product_category_id[${cardIndex}]']`);
    let productNameField = document.querySelector(`[name='product_name[${cardIndex}]']`);
    let productCategoryField = document.querySelector(`[name='product_category[${cardIndex}]']`);

    stockTypeField.value = selectedProduct?.power_attribute.stock_type ?? '';
    lensPhysicalityField.value = selectedProduct?.power_attribute.contact_lens_type ?? '';
    lensDisposablilityField.value = selectedProduct?.power_attribute.contact_lens_disposability ?? '';
    productHsnField.value = selectedProduct?.hsn ?? '';
    productAvailableQtyField.value = selectedProduct?.product_quantity ?? '';
    productBrandField.value = selectedProduct?.brand_name ?? '';
    productUnitPriceField.value = selectedProduct?.sale_price ?? '';
    productUnitTypeField.value = selectedProduct?.unit_name ?? '';
    productCategoryIdField.value = selectedProduct?.category_id ?? '';
    productNameField.value = selectedProduct?.product_name ?? '';
    productCategoryField.value = selectedProduct?.category_name ?? '';
    productPurchaseQtyField.value = '';
    productPurchaseQtyField.max = selectedProduct?.product_quantity;

    if (selectedProduct.discount > 0) {
        discountCheckDiv.style.display = 'block';
        discountValueText.innerHTML = '<h6>Discount available !</h6> Apply discount : ' + selectedProduct.discount + '%';
        discountValueField.value = selectedProduct.discount;
    } else {
        discountCheckDiv.style.display = 'none';
    }

    productPurchaseQtyField.addEventListener('input', function () {
        let purchaseQty = parseFloat(productPurchaseQtyField.value) || 0;
        let productTotal;
        if (discountCheckbox.checked) {
            // Apply discount if the checkbox is checked
            let discountPercentage = parseFloat(discountValueField.value) || 0;
            let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
            productTotal = purchaseQty * discountedPrice;
        } else {
            // No discount, use the original sale price
            productTotal = purchaseQty * parseFloat(selectedProduct.sale_price) || 0;
        }
        productProductTotalField.value = productTotal.toFixed(2);
    });

    discountCheckbox.addEventListener('change', function () {
        let isChecked = discountCheckbox.checked;
        if (isChecked) {
            let discountPercentage = parseFloat(discountValueField.value) || 0;
            let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
            productProductTotalField.value = (discountedPrice * productPurchaseQtyField.value).toFixed(2);
            discountCheckbox.value = 'on';
        } else {
            productProductTotalField.value = (selectedProduct.sale_price * productPurchaseQtyField.value).toFixed(2);
            productProductTotalField.innerHTML = '';
            discountCheckbox.value = 'off';
        }
    });
}


function updateOtherProductFields(selectElement, cardIndex) {
    let selectedProduct = other_products_list.find(product => product.product_id == selectElement.value);
    let productCategoryField = document.querySelector(`[name='product_category[${cardIndex}]']`);
    let productBrandField = document.querySelector(`[name='product_brand[${cardIndex}]']`);
    let productCategoryIdField = document.querySelector(`[name='product_category_id[${cardIndex}]']`);

    let productHsnField = document.querySelector(`[name='product_hsn[${cardIndex}]']`);
    let productAvailableQtyField = document.querySelector(`[name='available_qty[${cardIndex}]']`);
    let productUnitPriceField = document.querySelector(`[name='unit_price[${cardIndex}]']`);
    let productPurchaseQtyField = document.querySelector(`[name='purchase_qty[${cardIndex}]']`);
    let productProductTotalField = document.querySelector(`[name='product_total[${cardIndex}]']`);
    let productDiscountCheckedField = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
    let discountCheckDiv = document.getElementById('discount_check_div[' + cardIndex + ']');
    let discountValueText = document.getElementById('discount_value[' + cardIndex + ']');
    let discountValueField = document.getElementById('discount_value_field[' + cardIndex + ']');
    let discountCheckbox = document.querySelector(`[name='discount_checked[${cardIndex}]']`);
    let productUnitTypeField = document.querySelector(`[name='unit_type[${cardIndex}]']`);
    let productNameField = document.querySelector(`[name='product_name[${cardIndex}]']`);

    productCategoryField.value = selectedProduct?.category_name ?? '';
    productHsnField.value = selectedProduct?.hsn ?? '';
    productAvailableQtyField.value = selectedProduct?.store_product_quantity ?? '';
    productBrandField.value = selectedProduct?.brand_name ?? '';
    productUnitPriceField.value = selectedProduct?.sale_price ?? '';
    productUnitTypeField.value = selectedProduct?.unit_name ?? '';
    productCategoryIdField.value = selectedProduct?.category_id ?? '';
    productNameField.value = selectedProduct?.product_name ?? '';
    productPurchaseQtyField.value = '';
    productPurchaseQtyField.max = selectedProduct?.store_product_quantity;


    if (selectedProduct.discount > 0) {
        discountCheckDiv.style.display = 'block';
        discountValueText.innerHTML = '<h6>Discount available !</h6> Apply discount : ' + selectedProduct.discount + '%';
        discountValueField.value = selectedProduct.discount;
    } else {
        discountCheckDiv.style.display = 'none';
    }

    productPurchaseQtyField.addEventListener('input', function () {
        let purchaseQty = parseFloat(productPurchaseQtyField.value) || 0;
        let productTotal;
        if (discountCheckbox.checked) {
            // Apply discount if the checkbox is checked
            let discountPercentage = parseFloat(discountValueField.value) || 0;
            let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
            productTotal = purchaseQty * discountedPrice;
        } else {
            // No discount, use the original sale price
            productTotal = purchaseQty * parseFloat(selectedProduct.sale_price) || 0;
        }
        productProductTotalField.value = productTotal.toFixed(2);
    });

    discountCheckbox.addEventListener('change', function () {
        let isChecked = discountCheckbox.checked;
        if (isChecked) {
            let discountPercentage = parseFloat(discountValueField.value) || 0;
            let discountedPrice = selectedProduct.sale_price * (1 - discountPercentage / 100);
            productProductTotalField.value = (discountedPrice * productPurchaseQtyField.value).toFixed(2);
            discountCheckbox.value = 'on';
        } else {
            productProductTotalField.value = (selectedProduct.sale_price * productPurchaseQtyField.value).toFixed(2);
            productProductTotalField.innerHTML = '';
            discountCheckbox.value = 'off';
        }
    });

}


</script>
<script>

function getProductsData() {
    // Assuming products_container is the parent container
    var productsContainer = document.getElementById('products_container');

    // Check if the container exists
    if (productsContainer) {
        // Get all product_widget elements inside products_container
        var productWidgets = productsContainer.getElementsByClassName('product_widget');

        // Initialize an array to store the product data
        var productsArray = [];

        // Loop through each product_widget element
        for (var i = 0; i < productWidgets.length; i++) {
            var productWidget = productWidgets[i];
            var productData = {};

            // Get all form elements (input, select, textarea) inside the current product_widget
            var formElements = productWidget.querySelectorAll('input, select, textarea');

            // Loop through each form element and extract key-value pairs
            formElements.forEach(function (formElement) {
                // Use the element's name attribute as the key and its value as the value
                productData[formElement.name] = formElement.value.trim();
            });

            // Add the product data to the array
            productsArray.push(productData);
        }

        let cartDataField = document.querySelector(`[name='cartData']`);
        // Now, productsArray contains the data of form elements inside all product_widgets
        let jsonData = JSON.stringify(productsArray);
        console.log(jsonData);
        cartDataField.value = jsonData;


        const totalSum = productsArray.reduce((sum, product) => {
            for (const key in product) {
                if (key.startsWith("product_total[") && key.endsWith("]")) {
                    const productTotal = parseFloat(product[key]);
                    sum += isNaN(productTotal) ? 0 : productTotal;
                }
            }
            return sum;
        }, 0);

        // Display total sum in the <p> element with id 'totalSum'
        document.getElementById('totalSum').textContent = "Billing amount: ₹" + totalSum.toFixed(2);
        document.getElementsByName('amount_paid')[0].max = totalSum.toFixed(2);

        // Display total number of products in the <p> element with id 'totalProducts'
        document.getElementById('totalProducts').textContent = "Total Products: " + productsArray.length;


        //for generating preview table


        var tableHtml = '<table>';
        tableHtml += '<thead><tr><th>Sl. No</th><th>Product Name</th><th>Category</th><th style="text-align: end;">Purchase Qty</th><th style="text-align: end;">Product Total</th></tr></thead>';
        tableHtml += '<tbody>';

        var grandTotal = 0;

        productsArray.forEach(function (product, index) {
            var slNo = index + 1;

            // Find properties that start with 'product_name'
            var productNameKey = Object.keys(product).find(key => key.startsWith('product_name['));
            var categoryKey = Object.keys(product).find(key => key.startsWith('product_category['));
            var purchaseQtyKey = Object.keys(product).find(key => key.startsWith('purchase_qty['));
            var productTotalKey = Object.keys(product).find(key => key.startsWith('product_total['));

            var productName = product[productNameKey];
            var category = product[categoryKey];
            var purchaseQty = product[purchaseQtyKey];
            var productTotal = parseFloat(product[productTotalKey]);
            grandTotal += productTotal;

            tableHtml += '<tr>';
            tableHtml += '<td>' + slNo + '</td>';
            tableHtml += '<td>' + productName + '</td>';
            tableHtml += '<td>' + category + '</td>';
            tableHtml += '<td style="text-align: end;">' + purchaseQty + '</td>';
            tableHtml += '<td style="text-align: end;">₹' + productTotal.toFixed(2) + '</td>';
            tableHtml += '</tr>';
        });

        tableHtml += '</tbody>';
        tableHtml += '<tfoot><tr><td colspan="4">Grand Total</td><td style="text-align: end;">₹' + grandTotal.toFixed(2) + '</td></tr></tfoot>';
        tableHtml += '</table>';

        document.getElementById('preview').innerHTML = tableHtml;

        generateLinkedItemUi(productsArray);
    }
}
</script>
<script>
    function generateLinkedItemUi(productsArray){

        let category1Products = [];
        let category2Products = [];
        document.getElementById('category1Container').innerHTML = ``;
        productsArray.forEach(product => {
            // Extracting the keys dynamically
            const keys = Object.keys(product);

            // Check if there is a key starting with "product_category_id"
            const categoryIdKey = keys.find(key => key.startsWith("product_category_id"));

            // If the key exists and the value is "1" or "2", categorize the product
            if (categoryIdKey && (product[categoryIdKey] === "1" || product[categoryIdKey] === "2")) {
                if (product[categoryIdKey] === "1") {
                    category1Products.push(product);
                } else if (product[categoryIdKey] === "2") {
                    category2Products.push(product);
                }
            }
        });

        if(category2Products.length>0){
        var category1Container = document.getElementById('category1Container');
        var productCategoryDiv = document.createElement('div');
        productCategoryDiv.className = 'product-category';

        productCategoryDiv.innerHTML = '';
        category1Container.innerHTML = '';
        var heading = document.createElement('h2');
        heading.textContent = 'Link items';
        category1Container.appendChild(heading);
        }

        // Create a table for each product category
        var table = document.createElement('table');
        table.className = 'product-category-table';

        // Create the table header
        var headerRow = table.createTHead().insertRow();

        var slnoHeader = document.createElement('th');
        slnoHeader.textContent = 'Sl. No';
        headerRow.appendChild(slnoHeader);

        var lensHeader = document.createElement('th');
        lensHeader.textContent = 'Lens';
        headerRow.appendChild(lensHeader);
        var optionHeader = document.createElement('th');
        optionHeader.textContent = 'Options';
        headerRow.appendChild(optionHeader);

        category2Products.forEach((product, index) => {
        const keys = Object.keys(product);
        const purchaseQtyKey = keys.find(key => key.startsWith("purchase_qty"));
        const productNameKey = keys.find(key => key.startsWith("product_name"));

        for(let i = 1; i <= parseInt(product[purchaseQtyKey]);i++){
        var row = table.insertRow();
        var slnoCell = row.insertCell(0);
        slnoCell.textContent = i;

        // lens column
        var lensCell = row.insertCell(1);
        lensCell.textContent = product[productNameKey];

        // Options column
        var optionCell = row.insertCell(2);
        optionCell.className = 'linked-item-cell';

        var dropdown = document.createElement('select');
        dropdown.className = 'form-select linkedItemSelect';
        dropdown.name = product[productNameKey] + '--' + productNameKey + "--" + product.product;

        var noLinkedItemOption = document.createElement('option');
        noLinkedItemOption.value = '';
        noLinkedItemOption.textContent = 'No Linked Item';
        dropdown.appendChild(noLinkedItemOption);

          category1Products.forEach(category1Product => {
            const keys = Object.keys(category1Product);
            const lensKeys = Object.keys(product);
            const purchaseQtyLensKey = keys.find(key => key.startsWith("purchase_qty"));
            const productNameLensKey = keys.find(key => key.startsWith("product_name"));
            const productLensKey = lensKeys.find(key => key.startsWith("product_name"));

            for (let j = 1; j <= parseInt(category1Product[purchaseQtyLensKey]); j++) {
                var option = document.createElement('option');
                option.value = category1Product[productNameLensKey] + "--" + j + "--" + productLensKey + "--" + category1Product.product+"--"+productNameLensKey; // Set the actual value based on your data
                option.textContent = category1Product[productNameLensKey] + "-" + j; // Set the actual text based on your data
                dropdown.appendChild(option);
            }
        });
        dropdown.addEventListener('change', function () {
            handleDropdownChange(productsArray);
        });
        // Append the dropdown to the option cell
        optionCell.appendChild(dropdown);
        }

        document.getElementById('category1Container').appendChild(table);

        });


    }
</script>
<script>
  function generateLinkedItemUi(productsArray) {

    let frameProductsList = [];
    let lensProductsList = [];

    document.getElementById('category1Container').innerHTML = ``;
    productsArray.forEach(product => {
        const keys = Object.keys(product);
        const categoryIdKey = keys.find(key => key.startsWith("product_category_id"));
        if (categoryIdKey && (product[categoryIdKey] === "1" || product[categoryIdKey] === "2")) {
            if (product[categoryIdKey] === "1") {
                frameProductsList.push(product);
            } else if (product[categoryIdKey] === "2") {
                lensProductsList.push(product);
            }
        }
    });

    if (lensProductsList.length > 0) {
        var category1Container = document.getElementById('category1Container');
        var productCategoryDiv = document.createElement('div');
        productCategoryDiv.className = 'product-category';

        productCategoryDiv.innerHTML = '';
        category1Container.innerHTML = '';
        var heading = document.createElement('h2');
        heading.textContent = 'Link items';
        category1Container.appendChild(heading);
    }

    // Create a table for each product category
    var table = document.createElement('table');
    table.className = 'product-category-table';

    // Create the table header
    var headerRow = table.createTHead().insertRow();

    var slnoHeader = document.createElement('th');
    slnoHeader.textContent = 'Sl. No';
    headerRow.appendChild(slnoHeader);

    var lensHeader = document.createElement('th');
    lensHeader.textContent = 'Lens';
    headerRow.appendChild(lensHeader);
    var optionHeader = document.createElement('th');
    optionHeader.textContent = 'Options';
    headerRow.appendChild(optionHeader);
    let serialNumberCounter = 0;

    lensProductsList.forEach((product, index) => {
        const keys = Object.keys(product);
        const purchaseQtyKey = keys.find(key => key.startsWith("purchase_qty"));
        const productNameKey = keys.find(key => key.startsWith("product_name"));

        for (let i = 1; i <= parseInt(product[purchaseQtyKey]); i++) {
            var row = table.insertRow();
            serialNumberCounter++;
            var slnoCell = row.insertCell(0);
            slnoCell.textContent = serialNumberCounter;

            // lens column
            var lensCell = row.insertCell(1);
            lensCell.textContent = product[productNameKey];

            // Options column
            var optionCell = row.insertCell(2);
            optionCell.className = 'linked-item-cell';

            var dropdown = document.createElement('select');
            dropdown.className = 'form-select linkedItemSelect';
            dropdown.name = product[productNameKey] + '--' + productNameKey + "--" + product.product;

            var noLinkedItemOption = document.createElement('option');
            noLinkedItemOption.value = 'NA';
            noLinkedItemOption.textContent = 'No Linked Item';
            dropdown.appendChild(noLinkedItemOption);

            frameProductsList.forEach(category1Product => {
                const keys = Object.keys(category1Product);
                const lensKeys = Object.keys(product);
                const purchaseQtyLensKey = keys.find(key => key.startsWith("purchase_qty"));
                const productNameLensKey = keys.find(key => key.startsWith("product_name"));
                const productLensKey = lensKeys.find(key => key.startsWith("product_name"));

                for (let j = 1; j <= parseInt(category1Product[purchaseQtyLensKey]); j++) {
                    var option = document.createElement('option');
                    option.value = category1Product[productNameLensKey] + "--" + j + "--" + productLensKey + "--" + category1Product.product + "--" + productNameLensKey; // Set the actual value based on your data
                    option.textContent = category1Product[productNameLensKey]; // Set the actual text based on your data
                    dropdown.appendChild(option);
                }
            });
             // Append the dropdown to the option cell
            optionCell.appendChild(dropdown);

            dropdown.addEventListener('change', function (event) {
                handleDropdownChange(productsArray,event);
            });

        }

        document.getElementById('category1Container').appendChild(table);

    });


}

function handleDropdownChange(productsArray,event) {
    var selectedOptions = [];
    const linkJsonList = [];

    // Get all linkedItemSelect dropdowns
    const linkedItemSelects = document.querySelectorAll('.linkedItemSelect');
    // Iterate through all dropdowns and their options
    linkedItemSelects.forEach(currentDropdown => {
        selectedOptions.push(currentDropdown.value);
    });

    linkedItemSelects.forEach(currentDropdown => {
            Array.from(currentDropdown.options).forEach(option => {
                 if (option.value !== 'NA' && selectedOptions.includes(option.value)) {
                    // Hide the option
                    option.style.display = 'none';
                } else {
                    // Show the option (in case it was previously hidden)
                    option.style.display = '';
                }
            });
    });

    linkedItemSelects.forEach((select, index) => {
        const [lensName, lensLinkedCount, attachedLensIndexKey, frameId] = select.value.split('--');
        linkJsonList.push({
            "lensIndexKey": attachedLensIndexKey,
            "frameId": frameId,
        });
    });
    const jsonString = JSON.stringify(linkJsonList);

    // Set the value of the input field with ID 'linkedData'
    const linkedDataInput = document.getElementById('linkedData');
    linkedDataInput.value = jsonString;
    linkJsonList.forEach(link => {
        productsArray.forEach(category1Product => {
            category1Product.linkedFrameIds = [];
        });
    });

    linkJsonList.forEach(link => {
        productsArray.forEach(category1Product => {
            const keys = Object.keys(category1Product);
            // Check if attachedLensIndexKey is present in category1Product
            if (keys.includes(link.lensIndexKey)) {
                // Check if linkedFrameIds array exists, if not, create it
                if (!category1Product.linkedFrameIds) {
                    category1Product.linkedFrameIds = [];
                }

                // Add linkedFrameId value to the array
                category1Product.linkedFrameIds.push(link.frameId);
            }
        });
    });
    let cartDataField = document.querySelector(`[name='cartData']`);
    let jsonData = JSON.stringify(productsArray);
    cartDataField.value = jsonData;

}
</script>
</body>

</html>